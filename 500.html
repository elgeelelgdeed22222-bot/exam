<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>امتحان العلوم - أ/ إسماعيل</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --border-radius: 12px;
            --box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 25px 20px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        
        .card:hover {
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.05rem;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            transition: var(--transition);
            text-align: center;
            letter-spacing: 2px;
        }
        
        .form-control:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            width: 100%;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-success {
            background: linear-gradient(to right, var(--success-color), #2ecc71);
        }
        
        .btn-danger {
            background: linear-gradient(to right, var(--accent-color), #e67e22);
        }
        
        .timer-container {
            background: linear-gradient(to right, #8e44ad, #9b59b6);
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
            display: none;
        }
        
        .timer {
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: 3px;
            margin-bottom: 10px;
        }
        
        .timer-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .question-number {
            background-color: var(--secondary-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-left: 15px;
            margin-bottom: 15px;
        }
        
        .question-text {
            font-size: 1.15rem;
            margin-bottom: 25px;
            color: var(--dark-color);
            font-weight: 600;
            line-height: 1.7;
        }
        
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            padding: 18px 20px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            display: flex;
            align-items: center;
        }
        
        .option:hover {
            background-color: #e9f7fe;
            border-color: var(--secondary-color);
        }
        
        .option.selected {
            background-color: #d1ecf1;
            border-color: var(--secondary-color);
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .option-letter {
            background-color: #ddd;
            color: #333;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-left: 15px;
            flex-shrink: 0;
        }
        
        .selected .option-letter {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .results-container {
            text-align: center;
            padding: 30px 20px;
        }
        
        .score-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: conic-gradient(var(--success-color) 0% 80%, #eee 80% 100%);
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .score-inner {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }
        
        .score-value {
            font-size: 3rem;
            color: var(--primary-color);
            line-height: 1;
        }
        
        .score-label {
            font-size: 1.2rem;
            color: #666;
            margin-top: 5px;
        }
        
        .correction-item {
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            text-align: right;
            border-left: 5px solid #ddd;
        }
        
        .correction-item.correct {
            border-left-color: var(--success-color);
        }
        
        .correction-item.incorrect {
            border-left-color: var(--accent-color);
        }
        
        .question-result {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .user-answer, .correct-answer {
            padding: 8px 15px;
            border-radius: 6px;
            display: inline-block;
            margin-top: 5px;
            font-size: 0.95rem;
        }
        
        .user-answer {
            background-color: #fee;
            color: var(--accent-color);
        }
        
        .correct-answer {
            background-color: #e8f8ef;
            color: var(--success-color);
        }
        
        .hidden {
            display: none;
        }
        
        .message {
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 25px;
            background-color: var(--primary-color);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            font-size: 0.95rem;
        }
        
        .footer p {
            margin-bottom: 10px;
        }
        
        .footer strong {
            color: var(--secondary-color);
        }
        
        .exam-info {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
            font-size: 0.95rem;
            color: #666;
        }
        
        .info-item {
            background-color: #f8f9fa;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            flex: 1;
            min-width: 150px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .info-value {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .question-text {
                font-size: 1.05rem;
            }
            
            .option {
                padding: 15px;
                font-size: 0.95rem;
            }
            
            .timer {
                font-size: 1.8rem;
            }
            
            .score-circle {
                width: 150px;
                height: 150px;
            }
            
            .score-inner {
                width: 110px;
                height: 110px;
            }
            
            .score-value {
                font-size: 2.5rem;
            }
            
            .footer {
                font-size: 0.85rem;
                padding: 20px 15px;
            }
            
            .exam-info {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.3rem;
            }
            
            .card {
                padding: 20px 15px;
            }
            
            .question-text {
                font-size: 1rem;
            }
            
            .option {
                padding: 12px;
                font-size: 0.9rem;
            }
            
            .timer {
                font-size: 1.5rem;
            }
            
            .btn {
                padding: 14px 20px;
                font-size: 1rem;
            }
        }
        
        .instructions {
            background-color: #f8f9fa;
            border-right: 5px solid var(--secondary-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        
        .instructions h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .instructions ul {
            padding-right: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .instructions .important {
            color: var(--accent-color);
            font-weight: 600;
        }
        
        .finish-message {
            background: linear-gradient(to right, #1a2980, #26d0ce);
            color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            text-align: center;
            margin: 30px 0;
            box-shadow: var(--box-shadow);
        }
        
        .finish-message h2 {
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .finish-message p {
            margin-bottom: 15px;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .finish-message .highlight {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: var(--border-radius);
            display: inline-block;
            margin: 15px 0;
            font-weight: 700;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- صفحة الدخول -->
        <div id="login-page">
            <div class="header">
                <h1><i class="fas fa-graduation-cap"></i> امتحان العلوم الإلكتروني</h1>
                <p>أ/ إسماعيل - 01122104596</p>
            </div>
            
            <div class="card">
                <h2 style="color: var(--primary-color); margin-bottom: 20px; text-align: center;"><i class="fas fa-key"></i> الدخول إلى الامتحان</h2>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> تعليمات هامة:</h3>
                    <ul>
                        <li>يجب إدخال الكود المكون من 9 أرقام المخصص لك للدخول إلى الامتحان.</li>
                        <li>مدة الامتحان: <span class="important">90 دقيقة (ساعة ونصف)</span>.</li>
                        <li>الامتحان مسموح به <span class="important">مرة واحدة فقط</span> لكل طالب.</li>
                        <li>بعد انتهاء الامتحان، ستظهر نتيجتك فوراً مع تصحيح الأخطاء.</li>
                        <li>الرجاء <span class="important">عدم إعادة تحميل الصفحة</span> أثناء الامتحان حتى لا تفقد إجاباتك.</li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="student-code"><i class="fas fa-user-check"></i> أدخل الكود الخاص بك (9 أرقام)</label>
                    <input type="text" id="student-code" class="form-control" maxlength="9" placeholder="أدخل الكود المكون من 9 أرقام" inputmode="numeric">
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666; text-align: center;">الكود يتكون من 9 أرقام فقط، تأكد من إدخاله بشكل صحيح</p>
                </div>
                
                <button id="start-exam-btn" class="btn">
                    <i class="fas fa-play-circle"></i> بدء الامتحان
                </button>
                
                <div id="login-message" class="message hidden"></div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                    <p style="text-align: center; color: #666; font-size: 0.9rem;">
                        <i class="fas fa-exclamation-triangle"></i> إذا واجهت أي مشكلة، يرجى التواصل مع أ/ إسماعيل على الرقم 01122104596
                    </p>
                </div>
            </div>
        </div>
        
        <!-- صفحة الامتحان -->
        <div id="exam-page" class="hidden">
            <div class="header">
                <h1><i class="fas fa-pencil-alt"></i> امتحان العلوم - الاختيار من متعدد</h1>
                <p>أ/ إسماعيل - 01122104596</p>
            </div>
            
            <div class="timer-container" id="timer-container">
                <div class="timer" id="timer">90:00</div>
                <div class="timer-label">الوقت المتبقي للامتحان</div>
            </div>
            
            <div class="exam-info">
                <div class="info-item">
                    <div>رقم الطالب</div>
                    <div class="info-value" id="student-id-display">-</div>
                </div>
                <div class="info-item">
                    <div>السؤال الحالي</div>
                    <div class="info-value" id="current-question">1 / 50</div>
                </div>
                <div class="info-item">
                    <div>الأسئلة المجابة</div>
                    <div class="info-value" id="answered-questions">0 / 50</div>
                </div>
                <div class="info-item">
                    <div>الحالة</div>
                    <div class="info-value" id="exam-status">جاري الإجابة</div>
                </div>
            </div>
            
            <div class="card">
                <div class="question-number" id="question-number">1</div>
                <div class="question-text" id="question-text">سؤال الامتحان يظهر هنا</div>
                
                <div class="options-container" id="options-container">
                    <!-- الخيارات تظهر هنا ديناميكياً -->
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button id="prev-btn" class="btn" style="background: linear-gradient(to right, #95a5a6, #7f8c8d);">
                    <i class="fas fa-arrow-right"></i> السابق
                </button>
                <button id="next-btn" class="btn">
                    التالي <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button id="submit-exam-btn" class="btn btn-danger">
                    <i class="fas fa-paper-plane"></i> إنهاء الامتحان والتسليم
                </button>
                <p style="margin-top: 15px; color: #666; font-size: 0.9rem;">
                    <i class="fas fa-exclamation-circle"></i> تأكد من مراجعة جميع إجاباتك قبل التسليم
                </p>
            </div>
            
            <div class="instructions" style="margin-top: 30px;">
                <h3><i class="fas fa-lightbulb"></i> ملاحظات:</h3>
                <ul>
                    <li>يمكنك التنقل بين الأسئلة باستخدام زر السابق والتالي.</li>
                    <li>يمكنك تغيير إجابتك في أي وقت قبل إنهاء الامتحان.</li>
                    <li>سيتم احتساب الوقت تلقائياً، ولن تتمكن من إكمال الامتحان بعد انتهاء الوقت.</li>
                    <li>بعد إنهاء الامتحان، ستظهر نتيجتك مع التصحيح المفصل.</li>
                </ul>
            </div>
        </div>
        
        <!-- صفحة النتائج -->
        <div id="results-page" class="hidden">
            <div class="header">
                <h1><i class="fas fa-chart-line"></i> نتيجة الامتحان</h1>
                <p>أ/ إسماعيل - 01122104596</p>
            </div>
            
            <div class="results-container">
                <div class="score-circle" id="score-circle">
                    <div class="score-inner">
                        <div class="score-value" id="score-value">0%</div>
                        <div class="score-label">الدرجة النهائية</div>
                    </div>
                </div>
                
                <div class="exam-info">
                    <div class="info-item">
                        <div>رقم الطالب</div>
                        <div class="info-value" id="result-student-id">-</div>
                    </div>
                    <div class="info-item">
                        <div>الدرجة</div>
                        <div class="info-value" id="result-score">0 / 50</div>
                    </div>
                    <div class="info-item">
                        <div>النسبة المئوية</div>
                        <div class="info-value" id="result-percentage">0%</div>
                    </div>
                    <div class="info-item">
                        <div>الحالة</div>
                        <div class="info-value" id="result-status">تم التسليم</div>
                    </div>
                </div>
                
                <div class="finish-message">
                    <h2><i class="fas fa-trophy"></i> تم إنهاء الامتحان بنجاح!</h2>
                    <p>شكراً لك على المشاركة في الامتحان الإلكتروني</p>
                    <div class="highlight">
                        <i class="fas fa-camera"></i> يرجى تصوير الشاشة وإرسالها إلى أستاذ إسماعيل
                    </div>
                    <p>على الرقم: <strong>01122104596</strong></p>
                </div>
                
                <div style="text-align: right; margin: 30px 0 20px;">
                    <h3 style="color: var(--primary-color); margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px;">
                        <i class="fas fa-check-circle"></i> التصحيح التفصيلي للإجابات
                    </h3>
                </div>
                
                <div id="corrections-container">
                    <!-- التصحيح التفصيلي يظهر هنا ديناميكياً -->
                </div>
                
                <div style="margin-top: 40px;">
                    <button id="back-to-login-btn" class="btn">
                        <i class="fas fa-redo"></i> العودة إلى الصفحة الرئيسية
                    </button>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p><i class="fas fa-user-tie"></i> أ/ إسماعيل - مدرس العلوم</p>
            <p><i class="fas fa-phone"></i> للتواصل: 01122104596</p>
            <p><i class="fas fa-lock"></i> الامتحان مسموح به مرة واحدة فقط لكل طالب</p>
            <p style="margin-top: 15px; opacity: 0.8;">©  نظام الامتحانات الإلكترونية - جميع الحقوق محفوظة</p>
        </div>
    </div>

    <script>
        // قائمة الأكواد المسموح بها
        const allowedCodes = [
            "186435792", "195748362", "205947816", "249715836", "257964813", "265749813",
            "286934715", "294816573", "314892675", "341857692", "358962714", "362978541",
            "396175842", "458136972", "458907216", "472861395", "483279651", "495361827",
            "518936724", "537918246", "561294837", "572861493", "573682194", "582713964",
            "594821637", "610293847", "617492853", "621579483", "648931725", "671829453",
            "680237514", "684203957", "690472185", "715842906", "731894256", "739260541",
            "748216935", "748395261", "759204836", "760514839", "783541962", "819654372",
            "820563719", "824719365", "829174506", "831694752", "834726195", "847520391",
            "857462190", "902584713", "902735418", "903716284", "904217536", "916357284",
            "934716582", "940518273", "957364281", "963175428"
        ];

        // أسئلة الامتحان مع إجاباتها الصحيحة
        const examQuestions = [
            // أسئلة الاختيار من متعدد (35 سؤال)
            {
                question: "1. الكائنات الحية التي لا يمكنها التكيف مع ظروف البيئة ........",
                options: ["أ) يزداد عددها", "ب) تنقرض", "ج) يبقى عددها ثابتًا", "د) يمكنها الاستمرار في البيئة"],
                correctAnswer: 1,
                type: "mcq"
            },
            {
                question: "2. يعد اليربوع المصري من ........",
                options: ["أ) الحشرات", "ب) الزواحف", "ج) القوارض", "د) الطيور"],
                correctAnswer: 2,
                type: "mcq"
            },
            {
                question: "3. عند زيادة كتلة الجسم فإن طاقته الحركية ........",
                options: ["أ) تزداد", "ب) تقل", "ج) لا تتغير", "د) تنعدم"],
                correctAnswer: 0,
                type: "mcq"
            },
            {
                question: "4. إذا كان بإمكانك التواصل مع النمل فلا بد أن يكون لديك حاسة ........ قوية.",
                options: ["أ) سمع", "ب) بصر", "ج) شم", "د) لمس"],
                correctAnswer: 2,
                type: "mcq"
            },
            {
                question: "5. من الكائنات التي لها القدرة على لف الرأس في جميع الاتجاهات ........",
                options: ["أ) الثعابين", "ب) اليربوع", "ج) الدلافين", "د) البومة"],
                correctAnswer: 3,
                type: "mcq"
            },
            {
                question: "6. وجود الدهون تحت جلد الحيوان لتدفئته يعتبر ........",
                options: ["أ) تركيبيًا", "ب) سلوكيًا", "ج) وظيفيًا", "د) غريزيًا"],
                correctAnswer: 0,
                type: "mcq"
            },
            {
                question: "7. أي الأعضاء الآتية تعمل معًا لرؤية الأشياء المختلفة؟",
                options: ["أ) الأنف والمخ", "ب) العين والمخ", "ج) الأذن والمخ", "د) اللسان والمخ"],
                correctAnswer: 1,
                type: "mcq"
            },
            {
                question: "8. يقوم الجهاز ........ بتفتيت الطعام إلى أجزاء صغيرة.",
                options: ["أ) التنفسي", "ب) العصبي", "ج) الهضمي", "د) البولي"],
                correctAnswer: 2,
                type: "mcq"
            },
            {
                question: "9. يغطي جسم الثعلب القطبي ........",
                options: ["أ) وبر كثيف", "ب) جلد ثقيل", "ج) فراء كثيفة", "د) ريش كثيف"],
                correctAnswer: 2,
                type: "mcq"
            },
            {
                question: "10. طاقة حركة السيارة ........ طاقة حركة الشاحنة عندما تتحركان بنفس السرعة.",
                options: ["أ) أكبر من", "ب) تساوي", "ج) ضعف", "د) أقل من"],
                correctAnswer: 3,
                type: "mcq"
            },
            {
                question: "11. تعتبر ........ من المواد التي تعكس الضوء في اتجاه واحد.",
                options: ["أ) البلاستيك", "ب) الورق", "ج) الخشب", "د) المرايا"],
                correctAnswer: 3,
                type: "mcq"
            },
            {
                question: "12. كل ما يلي من مكونات الجهاز الهضمي ما عدا ........",
                options: ["أ) الفم", "ب) القلب", "ج) الأمعاء الدقيقة", "د) المريء"],
                correctAnswer: 1,
                type: "mcq"
            },
            {
                question: "14. تستخلص ........ السوائل من الطعام غير المهضوم.",
                options: ["أ) الأمعاء الدقيقة", "ب) الأمعاء الغليظة", "ج) المعدة", "د) الرئتان"],
                correctAnswer: 1,
                type: "mcq"
            },
            {
                question: "15. الكائنات التي تعيش في مناطق باردة يكون لديها ........",
                options: ["أ) فراء خفيفة", "ب) فراء كثيفة", "ج) حراشيف ملونة", "د) جلد رقيق"],
                correctAnswer: 1,
                type: "mcq"
            },
            {
                question: "16. القوة التي تعمل على تقليل سرعة الجسم أو تبطئ منها هي ........",
                options: ["أ) الاحتكاك", "ب) الجاذبية", "ج) السحب", "د) الدفع"],
                correctAnswer: 0,
                type: "mcq"
            },
            {
                question: "17. يمتلك الجسم أعلى طاقة وضع عندما يكون على ارتفاع ........",
                options: ["أ) 2 متر", "ب) 5 أمتار", "ج) 7 أمتار", "د) 9 أمتار"],
                correctAnswer: 3,
                type: "mcq"
            },
            {
                question: "18. تساعد خاصية ........ الضوء على رؤية صورتك في المرآة.",
                options: ["أ) انكسار", "ب) امتصاص", "ج) انعكاس", "د) كثافة"],
                correctAnswer: 2,
                type: "mcq"
            },
            {
                question: "19. يعد ........ عضوًا مشتركًا بين الجهازين الهضمي والتنفسي.",
                options: ["أ) البلعوم", "ب) المريء", "ج) المعدة", "د) الرئتين"],
                correctAnswer: 0,
                type: "mcq"
            },
            {
                question: "20. تساعد الأوراق ........ في النبات على امتصاص قدر كبير من ضوء الشمس.",
                options: ["أ) الصغيرة", "ب) المثلثية", "ج) التي بها أشواك", "د) العريضة"],
                correctAnswer: 3,
                type: "mcq"
            },
            {
                question: "21. تعتبر الطاقة ........ صورة من صور الطاقة التي يمكن رؤيتها.",
                options: ["أ) الحرارية", "ب) الضوئية", "ج) الصوتية", "د) الكهربية"],
                correctAnswer: 1,
                type: "mcq"
            },
            {
                question: "22. الحيوان الذي يعتمد على اللهث للحفاظ على برودة جسمه ........",
                options: ["أ) حرباء النمر", "ب) الثعلب القطبي", "ج) ثعلب الفنك", "د) سحلية الصحراء"],
                correctAnswer: 2,
                type: "mcq"
            },
            {
                question: "23. يقوم ........ بترجمة الرسائل العصبية التي تأتي من البيئة المحيطة بنا.",
                options: ["أ) الحبل الشوكي", "ب) الأعصاب", "ج) المخ", "د) القلب"],
                correctAnswer: 2,
                type: "mcq"
            },
            {
                question: "24. الطاقة التي تكتسبها كرة عند سقوطها من أعلى هي طاقة ........",
                options: ["أ) وضع", "ب) حركة", "ج) ضوئية", "د) كيميائية"],
                correctAnswer: 1,
                type: "mcq"
            },
            {
                question: "25. الطاقة الكيميائية المختزنة في البطاريات صورة من صور ........",
                options: ["أ) طاقة الوضع", "ب) طاقة الحركة", "ج) الطاقة الضوئية", "د) الطاقة الكهربية"],
                correctAnswer: 0,
                type: "mcq"
            },
            {
                question: "26. أثناء عملية الشهيق يدخل غاز ........ إلى الرئتين.",
                options: ["أ) النيتروجين", "ب) الأكسجين", "ج) ثاني أكسيد الكربون", "د) الهيليوم"],
                correctAnswer: 1,
                type: "mcq"
            },
            {
                question: "27. الخفافيش حيوانات ........",
                options: ["أ) ليلية", "ب) صباحية", "ج) لا تطير", "د) لا تسمع"],
                correctAnswer: 0,
                type: "mcq"
            },
            {
                question: "28. رفع الإبهام إلى أعلى أو خفضه إلى أسفل يعد من ........",
                options: ["أ) الألوان", "ب) الشفرات", "ج) الموجات", "د) الأضواء"],
                correctAnswer: 1,
                type: "mcq"
            },
            {
                question: "29. تستخلص الأسماك الأكسجين من الماء عن طريق ........",
                options: ["أ) الجلد", "ب) الزعانف", "ج) الخياشيم", "د) الرئتين"],
                correctAnswer: 2,
                type: "mcq"
            },
            {
                question: "30. يمكن التمييز بين الأصوات الحادة والأصوات الغليظة عن طريق ........",
                options: ["أ) نمط الصوت", "ب) درجة الصوت", "ج) صدى الصوت", "د) نوع الصوت"],
                correctAnswer: 1,
                type: "mcq"
            },
            {
                question: "31. عند سقوط الضوء على سطح ناعم ولامع فإنه ........",
                options: ["أ) ينتشر", "ب) ينعكس", "ج) ينكسر", "د) ينفذ"],
                correctAnswer: 1,
                type: "mcq"
            },
            {
                question: "32. استخدام القوة لتحريك الجسم بعيدًا عنك يمثل ........",
                options: ["أ) سحبًا", "ب) دفعًا", "ج) طاقة وضع", "د) طاقة ضوء"],
                correctAnswer: 1,
                type: "mcq"
            },
            {
                question: "33. كل مما يلي من التكيفات التركيبية ما عدا ........",
                options: ["أ) الآذان الطويلة", "ب) الفراء البنية", "ج) العيش في جحور", "د) الساق القصيرة"],
                correctAnswer: 2,
                type: "mcq"
            },
            {
                question: "34. جذور نبات النخيل تساعدها على ........",
                options: ["أ) الصمود أمام الرياح", "ب) الوصول إلى المياه الجوفية", "ج) تثبيت النبات في التربة", "د) جميع ما سبق"],
                correctAnswer: 3,
                type: "mcq"
            },
            {
                question: "35. عند وقوف حرباء النمر على أوراق الشجر يتغير لون حراشفها إلى اللون ........",
                options: ["أ) الأبيض", "ب) الأخضر", "ج) الأزرق", "د) الأسود"],
                correctAnswer: 1,
                type: "mcq"
            },
            // أسئلة صح وخطأ (26 سؤال)
            {
                question: "36. عند هبوط قطار الملاهي السريع فإن طاقة حركته تزداد.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "37. الجهاز التنفسي هو المسؤول عن دخول الهواء إلى الجسم.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "38. الحراشيف الملونة في حرباء النمر تعتبر مثالاً للتكيف التركيبي.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "39. تعتبر هجرة الطيور للبحث عن الغذاء تكيفًا سلوكيًا.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "40. يجب على السائق أن يقود بأسرع ما يمكن لتجنب الحوادث.",
                options: ["صح", "خطأ"],
                correctAnswer: 1,
                type: "truefalse"
            },
            {
                question: "41. الكرة الموجودة أعلى التل تمتلك طاقة وضع الجاذبية.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "42. يعيش النمل في مستعمرات تتكون من آلاف الأفراد.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "43. كلما قلت كتلة الجسم زادت طاقة حركته.",
                options: ["صح", "خطأ"],
                correctAnswer: 1,
                type: "truefalse"
            },
            {
                question: "44. تتحرك المراكب الشراعية في الماء بسبب قوة دفع الهواء.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "45. عند سقوط جسمين يكون مجموع الطاقات قبل التصادم أقل من مجموع الطاقات بعد التصادم.",
                options: ["صح", "خطأ"],
                correctAnswer: 1,
                type: "truefalse"
            },
            {
                question: "46. تزداد طاقة الوضع للجسم عند زيادة ارتفاعه عن سطح الأرض.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "47. يدخل الهواء الرئتين محملاً بغاز ثاني أكسيد الكربون.",
                options: ["صح", "خطأ"],
                correctAnswer: 1,
                type: "truefalse"
            },
            {
                question: "48. تعمل أعضاء الحس بشكل منفصل عن الجهاز العصبي.",
                options: ["صح", "خطأ"],
                correctAnswer: 1,
                type: "truefalse"
            },
            {
                question: "49. تستخدم الخفافيش حاسة الشم لتجنب الخطر.",
                options: ["صح", "خطأ"],
                correctAnswer: 1,
                type: "truefalse"
            },
            {
                question: "50. كلما زاد ميل المنحدر قلت طاقة حركة الجسم.",
                options: ["صح", "خطأ"],
                correctAnswer: 1,
                type: "truefalse"
            },
            {
                question: "51. تعد الأمعاء الدقيقة من أعضاء الجهاز الهضمي.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "52. ردود الفعل المنعكسة تتم بدون تفكير.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "53. عند اصطدام سيارة بدراجة يحدث ضرر أكبر للدراجة لزيادة كتلة السيارة.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "54. عند تغير موضع الجسم بالنسبة لنقطة ثابتة فإنه يكون ساكنًا.",
                options: ["صح", "خطأ"],
                correctAnswer: 1,
                type: "truefalse"
            },
            {
                question: "55. عندما تقوم بدفع الحائط فإنك تبذل شغلاً.",
                options: ["صح", "خطأ"],
                correctAnswer: 1,
                type: "truefalse"
            },
            {
                question: "56. موسم التزاوج عند الحيتان الحدباء يكون في فصل الشتاء.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "57. تساعد الشفرات على نقل المعلومات والتواصل.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "58. القوى غير المتزنة تسبب تغير موضع الأجسام.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "59. يقوم الخلاط الكهربي بتحويل الطاقة الكهربية إلى طاقة حركية.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "60. عند الجري وبذل المجهود يزداد عدد مرات التنفس.",
                options: ["صح", "خطأ"],
                correctAnswer: 0,
                type: "truefalse"
            },
            {
                question: "61. تؤثر قوة الاحتكاك في نفس اتجاه حركة الجسم.",
                options: ["صح", "خطأ"],
                correctAnswer: 1,
                type: "truefalse"
            }
        ];

        // متغيرات التطبيق
        let currentStudentCode = "";
        let currentQuestionIndex = 0;
        let userAnswers = new Array(examQuestions.length).fill(null);
        let examStarted = false;
        let examSubmitted = false;
        let timeLeft = 90 * 60; // 90 دقيقة بالثواني
        let timerInterval = null;
        let hasTakenExam = false;

        // عناصر DOM
        const loginPage = document.getElementById('login-page');
        const examPage = document.getElementById('exam-page');
        const resultsPage = document.getElementById('results-page');
        const studentCodeInput = document.getElementById('student-code');
        const startExamBtn = document.getElementById('start-exam-btn');
        const loginMessage = document.getElementById('login-message');
        const timerContainer = document.getElementById('timer-container');
        const timerDisplay = document.getElementById('timer');
        const studentIdDisplay = document.getElementById('student-id-display');
        const currentQuestionDisplay = document.getElementById('current-question');
        const answeredQuestionsDisplay = document.getElementById('answered-questions');
        const examStatusDisplay = document.getElementById('exam-status');
        const questionNumberDisplay = document.getElementById('question-number');
        const questionTextDisplay = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitExamBtn = document.getElementById('submit-exam-btn');
        const scoreCircle = document.getElementById('score-circle');
        const scoreValue = document.getElementById('score-value');
        const resultStudentId = document.getElementById('result-student-id');
        const resultScore = document.getElementById('result-score');
        const resultPercentage = document.getElementById('result-percentage');
        const resultStatus = document.getElementById('result-status');
        const correctionsContainer = document.getElementById('corrections-container');
        const backToLoginBtn = document.getElementById('back-to-login-btn');

        // التحقق من تخزين البيانات المحلية
        function checkLocalStorage() {
            const savedCode = localStorage.getItem('exam_student_code');
            const savedAnswers = localStorage.getItem('exam_answers_' + savedCode);
            const savedTime = localStorage.getItem('exam_start_time_' + savedCode);
            
            if (savedCode && savedAnswers) {
                // إذا كان الطالب قد بدأ الامتحان من قبل
                const answers = JSON.parse(savedAnswers);
                const hasAnswers = answers.some(answer => answer !== null);
                
                if (hasAnswers) {
                    // إذا كان الطالب قد أجاب على أسئلة، عرض رسالة
                    showMessage("لقد قمت ببدء الامتحان من قبل. يمكنك استكماله الآن.", "warning");
                    currentStudentCode = savedCode;
                    userAnswers = answers;
                    
                    // حساب الوقت المتبقي
                    if (savedTime) {
                        const startTime = parseInt(savedTime);
                        const currentTime = Math.floor(Date.now() / 1000);
                        const elapsedTime = currentTime - startTime;
                        timeLeft = 90 * 60 - elapsedTime;
                        
                        if (timeLeft <= 0) {
                            timeLeft = 0;
                            showMessage("لقد انتهى وقت الامتحان. سيتم تصحيح إجاباتك تلقائياً.", "error");
                            setTimeout(submitExam, 1000);
                        }
                    }
                    
                    studentCodeInput.value = savedCode;
                    return true;
                }
            }
            
            return false;
        }

        // عرض رسالة
        function showMessage(text, type) {
            loginMessage.textContent = text;
            loginMessage.className = `message ${type}`;
            loginMessage.classList.remove('hidden');
            
            setTimeout(() => {
                loginMessage.classList.add('hidden');
            }, 5000);
        }

        // بدء الامتحان
        function startExam() {
            const studentCode = studentCodeInput.value.trim();
            
            // التحقق من صحة الكود
            if (!studentCode) {
                showMessage("يرجى إدخال الكود الخاص بك", "error");
                return;
            }
            
            if (studentCode.length !== 9 || !/^\d+$/.test(studentCode)) {
                showMessage("الكود يجب أن يتكون من 9 أرقام فقط", "error");
                return;
            }
            
            if (!allowedCodes.includes(studentCode)) {
                showMessage("كود الدخول غير صحيح. يرجى التأكد من الكود وإعادة المحاولة", "error");
                return;
            }
            
            // التحقق مما إذا كان الطالب قد أدى الامتحان من قبل
            const savedScore = localStorage.getItem('exam_score_' + studentCode);
            if (savedScore) {
                showMessage("لقد قمت بأداء الامتحان من قبل. لا يمكنك الدخول مرة أخرى.", "error");
                return;
            }
            
            // حفظ بيانات الطالب والبدء
            currentStudentCode = studentCode;
            
            // التحقق مما إذا كان هناك إجابات سابقة
            const savedAnswers = localStorage.getItem('exam_answers_' + studentCode);
            if (savedAnswers) {
                userAnswers = JSON.parse(savedAnswers);
                examStarted = true;
            } else {
                // بدء الامتحان لأول مرة
                const startTime = Math.floor(Date.now() / 1000);
                localStorage.setItem('exam_student_code', studentCode);
                localStorage.setItem('exam_start_time_' + studentCode, startTime.toString());
                localStorage.setItem('exam_answers_' + studentCode, JSON.stringify(userAnswers));
                examStarted = true;
            }
            
            // الانتقال إلى صفحة الامتحان
            loginPage.classList.add('hidden');
            examPage.classList.remove('hidden');
            timerContainer.classList.remove('hidden');
            
            // عرض بيانات الطالب
            studentIdDisplay.textContent = studentCode;
            
            // بدء المؤقت
            startTimer();
            
            // تحميل السؤال الأول
            loadQuestion(currentQuestionIndex);
            
            // تحديث معلومات الامتحان
            updateExamInfo();
        }

        // بدء المؤقت
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeLeft--;
                
                // تحديث العرض
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // تغيير لون المؤقت عندما يقل الوقت
                if (timeLeft <= 10 * 60) { // 10 دقائق متبقية
                    timerContainer.style.background = "linear-gradient(to right, #e74c3c, #c0392b)";
                } else if (timeLeft <= 30 * 60) { // 30 دقيقة متبقية
                    timerContainer.style.background = "linear-gradient(to right, #f39c12, #e67e22)";
                }
                
                // انتهاء الوقت
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    showExamMessage("لقد انتهى وقت الامتحان. سيتم تصحيح إجاباتك تلقائياً.", "error");
                    setTimeout(submitExam, 2000);
                }
                
                // حفظ الوقت المتبقي كل دقيقة
                if (timeLeft % 60 === 0) {
                    const startTime = Math.floor(Date.now() / 1000) - (90 * 60 - timeLeft);
                    localStorage.setItem('exam_start_time_' + currentStudentCode, startTime.toString());
                }
            }, 1000);
        }

        // عرض رسالة في صفحة الامتحان
        function showExamMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            messageDiv.style.position = 'fixed';
            messageDiv.style.top = '20px';
            messageDiv.style.right = '20px';
            messageDiv.style.left = '20px';
            messageDiv.style.zIndex = '1000';
            messageDiv.style.textAlign = 'center';
            
            document.querySelector('.container').appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // تحميل السؤال
        function loadQuestion(index) {
            if (index < 0 || index >= examQuestions.length) return;
            
            currentQuestionIndex = index;
            const question = examQuestions[index];
            
            // تحديث رقم السؤال
            questionNumberDisplay.textContent = index + 1;
            questionTextDisplay.textContent = question.question;
            
            // مسح الخيارات السابقة
            optionsContainer.innerHTML = '';
            
            // إنشاء الخيارات الجديدة
            question.options.forEach((option, optionIndex) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = `option ${userAnswers[index] === optionIndex ? 'selected' : ''}`;
                optionDiv.dataset.optionIndex = optionIndex;
                
                const optionLetter = document.createElement('div');
                optionLetter.className = 'option-letter';
                
                if (question.type === 'truefalse') {
                    optionLetter.textContent = optionIndex === 0 ? '✓' : '✗';
                } else {
                    optionLetter.textContent = String.fromCharCode(1570 + optionIndex); // أحرف عربية
                }
                
                const optionText = document.createElement('div');
                optionText.textContent = option;
                
                optionDiv.appendChild(optionText);
                optionDiv.appendChild(optionLetter);
                
                optionDiv.addEventListener('click', () => selectOption(optionIndex));
                
                optionsContainer.appendChild(optionDiv);
            });
            
            // تحديث أزرار التنقل
            prevBtn.disabled = index === 0;
            nextBtn.disabled = index === examQuestions.length - 1;
            
            // تحديث معلومات الامتحان
            updateExamInfo();
        }

        // اختيار إجابة
        function selectOption(optionIndex) {
            userAnswers[currentQuestionIndex] = optionIndex;
            
            // تحديث العرض
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === optionIndex) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
            
            // حفظ الإجابة في التخزين المحلي
            localStorage.setItem('exam_answers_' + currentStudentCode, JSON.stringify(userAnswers));
            
            // تحديث معلومات الامتحان
            updateExamInfo();
        }

        // تحديث معلومات الامتحان
        function updateExamInfo() {
            currentQuestionDisplay.textContent = `${currentQuestionIndex + 1} / ${examQuestions.length}`;
            
            const answeredCount = userAnswers.filter(answer => answer !== null).length;
            answeredQuestionsDisplay.textContent = `${answeredCount} / ${examQuestions.length}`;
            
            if (answeredCount === examQuestions.length) {
                examStatusDisplay.textContent = "مكتمل";
                examStatusDisplay.style.color = "var(--success-color)";
            } else {
                examStatusDisplay.textContent = "جاري الإجابة";
                examStatusDisplay.style.color = "var(--secondary-color)";
            }
        }

        // السؤال السابق
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                loadQuestion(currentQuestionIndex - 1);
            }
        }

        // السؤال التالي
        function nextQuestion() {
            if (currentQuestionIndex < examQuestions.length - 1) {
                loadQuestion(currentQuestionIndex + 1);
            }
        }

        // إنهاء الامتحان
        function submitExam() {
            if (examSubmitted) return;
            
            // التحقق من الإجابات الفارغة
            const unansweredCount = userAnswers.filter(answer => answer === null).length;
            
            if (unansweredCount > 0) {
                if (!confirm(`لديك ${unansweredCount} سؤال بدون إجابة. هل تريد إنهاء الامتحان مع هذه الأسئلة الفارغة؟`)) {
                    return;
                }
            }
            
            examSubmitted = true;
            clearInterval(timerInterval);
            
            // حساب النتيجة
            let score = 0;
            examQuestions.forEach((question, index) => {
                if (userAnswers[index] === question.correctAnswer) {
                    score++;
                }
            });
            
            const percentage = Math.round((score / examQuestions.length) * 100);
            
            // حفظ النتيجة في التخزين المحلي
            localStorage.setItem('exam_score_' + currentStudentCode, score.toString());
            localStorage.setItem('exam_percentage_' + currentStudentCode, percentage.toString());
            localStorage.setItem('exam_completed_' + currentStudentCode, 'true');
            
            // الانتقال إلى صفحة النتائج
            examPage.classList.add('hidden');
            resultsPage.classList.remove('hidden');
            
            // عرض النتائج
            displayResults(score, percentage);
        }

        // عرض النتائج
        function displayResults(score, percentage) {
            resultStudentId.textContent = currentStudentCode;
            resultScore.textContent = `${score} / ${examQuestions.length}`;
            resultPercentage.textContent = `${percentage}%`;
            
            // تحديد الحالة بناءً على النسبة
            if (percentage >= 85) {
                resultStatus.textContent = "ممتاز";
                resultStatus.style.color = "var(--success-color)";
            } else if (percentage >= 70) {
                resultStatus.textContent = "جيد جداً";
                resultStatus.style.color = "#2ecc71";
            } else if (percentage >= 50) {
                resultStatus.textContent = "مقبول";
                resultStatus.style.color = "var(--warning-color)";
            } else {
                resultStatus.textContent = "ضعيف";
                resultStatus.style.color = "var(--accent-color)";
            }
            
            // تحديث دائرة النتيجة
            scoreValue.textContent = `${percentage}%`;
            
            // حساب زاوية الدائرة
            const angle = (percentage / 100) * 360;
            scoreCircle.style.background = `conic-gradient(var(--success-color) 0deg ${angle}deg, #eee ${angle}deg 360deg)`;
            
            // إنشاء التصحيح التفصيلي
            createCorrections(score);
        }

        // إنشاء التصحيح التفصيلي
        function createCorrections(score) {
            correctionsContainer.innerHTML = '';
            
            examQuestions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === question.correctAnswer;
                
                const correctionDiv = document.createElement('div');
                correctionDiv.className = `correction-item ${isCorrect ? 'correct' : 'incorrect'}`;
                
                const questionResult = document.createElement('div');
                questionResult.className = 'question-result';
                questionResult.textContent = `سؤال ${index + 1}: ${question.question}`;
                
                const userAnswerDiv = document.createElement('div');
                userAnswerDiv.className = 'user-answer';
                
                if (userAnswer === null) {
                    userAnswerDiv.textContent = `إجابتك: لم تقم بالإجابة`;
                } else {
                    userAnswerDiv.textContent = `إجابتك: ${question.options[userAnswer]}`;
                }
                
                const correctAnswerDiv = document.createElement('div');
                correctAnswerDiv.className = 'correct-answer';
                correctAnswerDiv.textContent = `الإجابة الصحيحة: ${question.options[question.correctAnswer]}`;
                
                correctionDiv.appendChild(questionResult);
                correctionDiv.appendChild(userAnswerDiv);
                
                if (!isCorrect) {
                    correctionDiv.appendChild(correctAnswerDiv);
                }
                
                correctionsContainer.appendChild(correctionDiv);
            });
        }

        // العودة إلى صفحة الدخول
        function backToLogin() {
            resultsPage.classList.add('hidden');
            loginPage.classList.remove('hidden');
            
            // إعادة تعيين المتغيرات
            currentStudentCode = "";
            currentQuestionIndex = 0;
            userAnswers = new Array(examQuestions.length).fill(null);
            examStarted = false;
            examSubmitted = false;
            timeLeft = 90 * 60;
            
            // مسح حقل الإدخال
            studentCodeInput.value = "";
            
            // إخفاء الرسالة
            loginMessage.classList.add('hidden');
        }

        // أحداث المستخدم
        startExamBtn.addEventListener('click', startExam);
        studentCodeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                startExam();
            }
        });
        
        prevBtn.addEventListener('click', prevQuestion);
        nextBtn.addEventListener('click', nextQuestion);
        submitExamBtn.addEventListener('click', () => {
            if (confirm("هل أنت متأكد من إنهاء الامتحان؟ لا يمكنك العودة بعد الإنتهاء.")) {
                submitExam();
            }
        });
        
        backToLoginBtn.addEventListener('click', backToLogin);

        // التحقق من التخزين المحلي عند التحميل
        window.addEventListener('load', () => {
            if (checkLocalStorage()) {
                showMessage("تم العثور على امتحان غير مكتمل. يمكنك استكماله الآن.", "warning");
            }
        });

        // حفظ الإجابات عند إغلاق الصفحة
        window.addEventListener('beforeunload', (e) => {
            if (examStarted && !examSubmitted) {
                e.preventDefault();
                e.returnValue = 'لديك إجابات غير محفوظة. هل تريد المغادرة حقاً؟';
            }
        });
    </script>
</body>
</html>
