<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø§ØµØ© - Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ù„Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            padding: 10px;
            max-width: 100%;
            overflow-x: hidden;
            background-image: linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #3498db;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3498db, #2ecc71, #e74c3c);
        }
        
        .header h1 {
            font-size: 18px;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }
        
        .header h2 {
            font-size: 16px;
            color: #f1c40f;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 8px 15px;
            border-radius: 5px;
            display: inline-block;
            margin: 5px 0;
            position: relative;
            z-index: 1;
        }
        
        .header h3 {
            font-size: 14px;
            margin-top: 10px;
            color: #ecf0f1;
            position: relative;
            z-index: 1;
        }
        
        .container {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }
        
        .code-input-section {
            text-align: center;
            background: linear-gradient(to bottom, #ffffff, #f8f9fa);
        }
        
        .code-input {
            width: 100%;
            max-width: 300px;
            padding: 12px;
            font-size: 18px;
            text-align: center;
            border: 2px solid #3498db;
            border-radius: 5px;
            margin: 15px 0;
            direction: ltr;
            background-color: #f8f9fa;
            letter-spacing: 2px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .code-input:focus {
            outline: none;
            border-color: #2ecc71;
            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.2);
            transform: scale(1.02);
        }
        
        .btn {
            background: linear-gradient(to bottom, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            background: linear-gradient(to bottom, #2980b9, #2573a7);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: linear-gradient(to bottom, #95a5a6, #7f8c8d);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        
        .question {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            font-size: 14px;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        
        .question:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .question-number {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #3498db;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .question-number::before {
            content: 'Ø³Ø¤Ø§Ù„';
            background: #3498db;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .option-row {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .true-false-option {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            text-align: center;
            font-weight: bold;
            max-width: 150px;
        }
        
        .option-true {
            background-color: #e8f6f3;
            color: #27ae60;
            border-color: #a3e4d7;
        }
        
        .option-false {
            background-color: #fdedec;
            color: #e74c3c;
            border-color: #f5b7b1;
        }
        
        .true-false-option:hover {
            transform: scale(1.05);
        }
        
        .true-false-option.selected {
            border-width: 3px;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
        }
        
        .option-true.selected {
            background-color: #d4efdf;
            border-color: #27ae60;
        }
        
        .option-false.selected {
            background-color: #fadbd8;
            border-color: #e74c3c;
        }
        
        .submit-btn {
            background: linear-gradient(to bottom, #27ae60, #219653);
            display: block;
            margin: 20px auto;
            width: 250px;
            font-size: 18px;
        }
        
        .submit-btn:hover {
            background: linear-gradient(to bottom, #219653, #1e8449);
        }
        
        .result {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #e8f6f3, #d4efdf);
            border-radius: 10px;
            margin-top: 20px;
            font-size: 14px;
            border: 2px solid #27ae60;
            position: relative;
            overflow: hidden;
        }
        
        .result::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
        }
        
        .score {
            font-size: 32px;
            color: #27ae60;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            position: relative;
            display: inline-block;
        }
        
        .score::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 10%;
            right: 10%;
            height: 3px;
            background: linear-gradient(90deg, transparent, #27ae60, transparent);
        }
        
        .mistakes {
            text-align: right;
            margin-top: 20px;
            padding: 15px;
            background-color: #fef9e7;
            border-radius: 8px;
            font-size: 13px;
            border: 1px solid #f1c40f;
        }
        
        .mistake-item {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 6px;
            background-color: white;
            border-right: 4px solid #e74c3c;
            transition: transform 0.2s;
        }
        
        .mistake-item:hover {
            transform: translateX(-5px);
        }
        
        .correct-answer {
            color: #27ae60;
            font-weight: bold;
            background-color: #d4efdf;
            padding: 3px 8px;
            border-radius: 4px;
            display: inline-block;
            margin: 3px 0;
        }
        
        .wrong-answer {
            color: #e74c3c;
            font-weight: bold;
            background-color: #fadbd8;
            padding: 3px 8px;
            border-radius: 4px;
            display: inline-block;
            margin: 3px 0;
        }
        
        .timer {
            position: fixed;
            top: 10px;
            left: 10px;
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 100;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            border: 1px solid #4a6491;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Courier New', monospace;
        }
        
        .timer::before {
            content: 'â°';
            font-size: 16px;
        }
        
        .error-message {
            color: #e74c3c;
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
            padding: 10px;
            background-color: #fadbd8;
            border-radius: 5px;
            border: 1px solid #e74c3c;
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .info-message {
            color: #3498db;
            margin-top: 10px;
            font-size: 13px;
            text-align: center;
            padding: 8px;
            background-color: #d6eaf8;
            border-radius: 5px;
        }
        
        .success-message {
            color: #27ae60;
            margin-top: 10px;
            font-size: 13px;
            text-align: center;
            padding: 8px;
            background-color: #d4efdf;
            border-radius: 5px;
            animation: fadeIn 1s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hidden {
            display: none;
        }
        
        .attempt-info {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 10px;
            text-align: center;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border: 1px dashed #bdc3c7;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
        }
        
        .progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .exam-stats {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .question-type-badge {
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin-right: 10px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 16px;
            }
            
            .header h2 {
                font-size: 14px;
            }
            
            .question {
                font-size: 13px;
                padding: 12px;
            }
            
            .true-false-option {
                padding: 10px;
                font-size: 13px;
            }
            
            .result, .mistakes {
                font-size: 12px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .timer {
                font-size: 12px;
                padding: 8px 12px;
            }
            
            .option-row {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .true-false-option {
                max-width: 200px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="timer" id="timer"></div>
    
    <div class="header">
        <h1>Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø§ØµØ©</h1>
        <h2>Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ù„Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</h2>
        <h3>Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØ§Ø¨ ÙˆØ§Ù„Ø®Ø·Ø£ - Ø§Ù…ØªØ­Ø§Ù† Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¢Ù…Ù†</h3>
    </div>
    
    <div class="container code-input-section" id="codeSection">
        <p>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù… (Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©):</p>
        <input type="text" id="studentCode" class="code-input" maxlength="9" placeholder="" pattern="\d*" inputmode="numeric" autocomplete="off">
        <div class="progress-bar">
            <div class="progress" id="codeProgress"></div>
        </div>
        <p class="info-message">Ø§Ù„ÙƒÙˆØ¯ Ù…ÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· (0-9) - ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù„ÙƒÙ„ ÙƒÙˆØ¯</p>
        <button class="btn" id="startExamBtn">Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
        <div class="error-message" id="codeError"></div>
        <div class="attempt-info" id="attemptInfo"></div>
        <div class="exam-stats">
            <div class="stat-item">
                <div class="stat-value" id="deviceAttempts">0</div>
                <div class="stat-label">Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="usedCodes">0</div>
                <div class="stat-label">Ø£ÙƒÙˆØ§Ø¯ Ù…Ø³ØªØ®Ø¯Ù…Ø©</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="timeRemaining">--:--</div>
                <div class="stat-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
            </div>
        </div>
    </div>
    
    <div class="container hidden" id="examSection">
        <div id="questionsContainer"></div>
        <div class="progress-bar">
            <div class="progress" id="examProgress"></div>
        </div>
        <p class="info-message" id="examProgressText">0/10 Ø¥Ø¬Ø§Ø¨Ø©</p>
        <button class="btn submit-btn" id="submitExamBtn">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ÙˆØªØµØ­ÙŠØ­ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</button>
    </div>
    
    <div class="container hidden" id="resultSection">
        <div id="resultContent"></div>
        <button class="btn" id="backToHomeBtn" style="margin-top: 20px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ (Ù†Ø¸Ø§Ù… ØµÙˆØ§Ø¨/Ø®Ø·Ø£)
        const examData = {
            title: "Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ù„Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ",
            grade: "Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ",
            type: "ØµÙˆØ§Ø¨ Ø£Ùˆ Ø®Ø·Ø£",
            instructions: "Ø¶Ø¹ ÙƒÙ„Ù…Ø© (ØµÙˆØ§Ø¨) Ø£Ùˆ (Ø®Ø·Ø£) Ø£Ù…Ø§Ù… ÙƒÙ„ Ø¹Ø¨Ø§Ø±Ø©",
            questions: [
                {
                    question: "ÙŠÙ…ØªÙ„Ùƒ Ø§Ù„ÙˆØ·Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù…Ù‚ÙˆÙ…Ø§Øª Ø·Ø¨ÙŠØ¹ÙŠØ© ÙˆØ¨Ø´Ø±ÙŠØ© ØªØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ù‚ÙŠØ§Ù… Ø§Ù„Ø²Ø±Ø§Ø¹Ø©.",
                    correctAnswer: "ØµÙˆØ§Ø¨" // 0 Ù„Ù„Ø®Ø·Ø£ØŒ 1 Ù„Ù„ØµÙˆØ§Ø¨
                },
                {
                    question: "ØªÙ†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø§ØµÙŠÙ„ ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ ØªÙ†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø§Ø® ÙÙŠ Ø§Ù„ÙˆØ·Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠ.",
                    correctAnswer: "Ø®Ø·Ø£"
                },
                {
                    question: "ÙŠØ¹Ø¯ Ø§Ù„Ø²Ø­Ù Ø§Ù„Ø¹Ù…Ø±Ø§Ù†ÙŠ Ù…Ù† Ù…Ø´ÙƒÙ„Ø§Øª Ø§Ù„Ø²Ø±Ø§Ø¹Ø© ÙÙŠ Ø§Ù„ÙˆØ·Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠ.",
                    correctAnswer: "ØµÙˆØ§Ø¨"
                },
                {
                    question: "Ø§Ù„Ø£ÙŠØ¯ÙŠ Ø§Ù„Ø¹Ø§Ù…Ù„Ø© Ø§Ù„Ù…Ø¯Ø±Ø¨Ø© Ù…Ù† Ø§Ù„Ù…Ù‚ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ù„Ù„Ø²Ø±Ø§Ø¹Ø©.",
                    correctAnswer: "Ø®Ø·Ø£"
                },
                {
                    question: "ÙŠØ¹ØªÙ…Ø¯ Ù…Ø´Ø±ÙˆØ¹ ØªÙˆØ´ÙƒÙ‰ Ø¹Ù„Ù‰ Ù…ÙŠØ§Ù‡ Ù†Ù‡Ø± Ø§Ù„Ù†ÙŠÙ„.",
                    correctAnswer: "ØµÙˆØ§Ø¨"
                },
                {
                    question: "ØªØ¹Ø¯ Ø§Ù„ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø®ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª Ø§Ù„ØªÙŠ ØªÙˆØ§Ø¬Ù‡ Ø§Ù„Ø²Ø±Ø§Ø¹Ø©.",
                    correctAnswer: "ØµÙˆØ§Ø¨"
                },
                {
                    question: "Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ù‚Ù…Ø­ ØªÙ‚ØªØµØ± Ø¹Ù„Ù‰ Ù…ØµØ± ÙÙ‚Ø·.",
                    correctAnswer: "Ø®Ø·Ø£"
                },
                {
                    question: "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø³Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© Ù…Ù† Ø¬Ù‡ÙˆØ¯ ØªØ·ÙˆÙŠØ± Ø§Ù„Ø²Ø±Ø§Ø¹Ø©.",
                    correctAnswer: "ØµÙˆØ§Ø¨"
                },
                {
                    question: "Ø³Ù‡ÙˆÙ„ Ù†Ù‡Ø± Ø§Ù„Ù†ÙŠÙ„ ÙÙŠ Ù…ØµØ± ÙˆØ§Ù„Ø³ÙˆØ¯Ø§Ù† ØªØªÙ…ÙŠØ² Ø¨ØªØ±Ø¨ØªÙ‡Ø§ Ø§Ù„Ø®ØµØ¨Ø©.",
                    correctAnswer: "ØµÙˆØ§Ø¨"
                },
                {
                    question: "Ù…Ø´Ø±ÙˆØ¹ Ù…Ø³ØªÙ‚Ø¨Ù„ Ù…ØµØ± ÙŠØ³ØªÙ‡Ø¯Ù Ø§Ø³ØªØµÙ„Ø§Ø­ Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ù„ÙŠÙˆÙ† ÙØ¯Ø§Ù†.",
                    correctAnswer: "ØµÙˆØ§Ø¨"
                }
            ]
        };

        // Ø¹Ù†Ø§ØµØ± DOM
        const codeSection = document.getElementById('codeSection');
        const examSection = document.getElementById('examSection');
        const resultSection = document.getElementById('resultSection');
        const studentCodeInput = document.getElementById('studentCode');
        const startExamBtn = document.getElementById('startExamBtn');
        const submitExamBtn = document.getElementById('submitExamBtn');
        const questionsContainer = document.getElementById('questionsContainer');
        const resultContent = document.getElementById('resultContent');
        const codeError = document.getElementById('codeError');
        const attemptInfo = document.getElementById('attemptInfo');
        const timerElement = document.getElementById('timer');
        const codeProgress = document.getElementById('codeProgress');
        const examProgress = document.getElementById('examProgress');
        const examProgressText = document.getElementById('examProgressText');
        const backToHomeBtn = document.getElementById('backToHomeBtn');
        const deviceAttemptsElement = document.getElementById('deviceAttempts');
        const usedCodesElement = document.getElementById('usedCodes');
        const timeRemainingElement = document.getElementById('timeRemaining');

        // Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        let examState = {
            studentCode: '',
            answers: new Array(examData.questions.length).fill(null),
            startTime: null,
            examCompleted: false,
            deviceId: null,
            examDuration: 1800 // 30 Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            // ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ÙØ±ÙŠØ¯
            examState.deviceId = generateAdvancedDeviceId();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
            checkTimeRestriction();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateStatistics();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø§Ù†Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯
            studentCodeInput.addEventListener('input', handleCodeInput);
            
            // ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            studentCodeInput.focus();
            
            // Ø²Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            startExamBtn.addEventListener('click', startExam);
            
            // Ø²Ø± Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            submitExamBtn.addEventListener('click', submitExam);
            
            // Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            backToHomeBtn.addEventListener('click', function() {
                resultSection.classList.add('hidden');
                codeSection.classList.remove('hidden');
                resetExam();
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ø¹Ø§Ù…
            updateTimer();
            setInterval(updateTimer, 1000);
            
            // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
            setInterval(updateRemainingTime, 1000);
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØµØ§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙƒÙˆØ¯
            studentCodeInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && this.value.length === 9) {
                    startExam();
                }
            });
        });

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯
        function handleCodeInput() {
            // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙÙ‚Ø·
            this.value = this.value.replace(/[^0-9]/g, '');
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            const progress = (this.value.length / 9) * 100;
            codeProgress.style.width = `${progress}%`;
            
            // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            if (this.value.length === 9) {
                codeError.textContent = '';
                startExamBtn.disabled = false;
                codeProgress.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙƒÙˆØ¯
                if (isCodeAlreadyUsed(this.value)) {
                    codeError.textContent = 'âš ï¸ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²';
                    codeProgress.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
                }
            } else {
                startExamBtn.disabled = true;
                codeProgress.style.background = 'linear-gradient(90deg, #3498db, #2ecc71)';
                if (this.value.length > 0) {
                    codeError.textContent = 'Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·';
                } else {
                    codeError.textContent = '';
                }
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStatistics() {
            const attempts = getExamAttempts();
            deviceAttemptsElement.textContent = attempts.deviceAttempts;
            usedCodesElement.textContent = attempts.usedCodes.length;
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
            if (attempts.deviceAttempts > 0) {
                attemptInfo.textContent = `Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø§ØªÙ Ù‚Ø§Ù… Ø¨Ù€ ${attempts.deviceAttempts} Ù…Ø­Ø§ÙˆÙ„Ø© Ø³Ø§Ø¨Ù‚Ø©`;
                if (attempts.deviceAttempts >= 2) {
                    attemptInfo.innerHTML += ' <span style="color:#e74c3c">(Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 2 Ù…Ø­Ø§ÙˆÙ„Ø©)</span>';
                }
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø­ØªÙ‰ Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„
        function updateRemainingTime() {
            const now = new Date();
            const midnight = new Date();
            midnight.setHours(24, 0, 0, 0);
            
            const diff = midnight.getTime() - now.getTime();
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            timeRemainingElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            
            // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„ÙˆÙ‚Øª Ø£Ù‚Ù„ Ù…Ù† Ø³Ø§Ø¹Ø©
            if (hours < 1) {
                timeRemainingElement.style.color = '#e74c3c';
            } else if (hours < 3) {
                timeRemainingElement.style.color = '#f39c12';
            } else {
                timeRemainingElement.style.color = '#2c3e50';
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„ÙˆÙ‚Øª
        function checkTimeRestriction() {
            const now = new Date();
            const currentHour = now.getHours();
            
            if (currentHour >= 0 && currentHour < 6) {
                codeError.textContent = "â° Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ØºÙŠØ± Ù…ØªØ§Ø­ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ÙÙŠ ÙˆÙ‚Øª Ù„Ø§Ø­Ù‚.";
                startExamBtn.disabled = true;
                studentCodeInput.disabled = true;
                return true;
            }
            return false;
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function startExam() {
            if (checkTimeRestriction()) return;
            
            const code = studentCodeInput.value.trim();
            
            if (code.length !== 9) {
                codeError.textContent = 'Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù… Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©';
                studentCodeInput.focus();
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙˆØ¯ Ù‚Ø¯ Ø§Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø¨Ù„ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø§ØªÙ
            if (isCodeAlreadyUsed(code)) {
                codeError.textContent = 'âŒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø§ØªÙ';
                studentCodeInput.value = '';
                studentCodeInput.focus();
                codeProgress.style.width = '0%';
                return;
            }
            
            // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
            const attemptResult = registerNewAttempt(code);
            
            if (!attemptResult.success) {
                codeError.textContent = attemptResult.message;
                return;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateStatistics();
            
            // Ø­ÙØ¸ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨
            examState.studentCode = code;
            examState.startTime = new Date();
            
            // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„ÙƒÙˆØ¯ ÙˆØ¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            codeSection.classList.add('hidden');
            examSection.classList.remove('hidden');
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            loadQuestions();
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            updateExamProgress();
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ù†Ø¸Ø§Ù… ØµÙˆØ§Ø¨/Ø®Ø·Ø£)
        function loadQuestions() {
            questionsContainer.innerHTML = '';
            
            examData.questions.forEach((q, index) => {
                const questionElement = document.createElement('div');
                questionElement.className = 'question';
                questionElement.id = `question-${index}`;
                
                questionElement.innerHTML = `
                    <div class="question-number">
                        <span class="question-type-badge">ØµÙˆØ§Ø¨/Ø®Ø·Ø£</span>
                        Ø³ ${index + 1}: ${q.question}
                    </div>
                    <div class="options">
                        <div class="option-row">
                            <div class="true-false-option option-true" data-question="${index}" data-answer="ØµÙˆØ§Ø¨">
                                âœ“ ØµÙˆØ§Ø¨
                            </div>
                            <div class="true-false-option option-false" data-question="${index}" data-answer="Ø®Ø·Ø£">
                                âœ— Ø®Ø·Ø£
                            </div>
                        </div>
                    </div>
                `;
                
                questionsContainer.appendChild(questionElement);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª
            document.querySelectorAll('.true-false-option').forEach(option => {
                option.addEventListener('click', function() {
                    const questionIndex = parseInt(this.getAttribute('data-question'));
                    const answerValue = this.getAttribute('data-answer');
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø®ÙŠØ§Ø±Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„
                    const questionElement = document.getElementById(`question-${questionIndex}`);
                    questionElement.querySelectorAll('.true-false-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±
                    this.classList.add('selected');
                    
                    // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (0 Ù„Ù„Ø®Ø·Ø£ØŒ 1 Ù„Ù„ØµÙˆØ§Ø¨)
                    examState.answers[questionIndex] = answerValue === 'ØµÙˆØ§Ø¨' ? 1 : 0;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                    updateExamProgress();
                });
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function updateExamProgress() {
            const answeredCount = examState.answers.filter(answer => answer !== null).length;
            const totalQuestions = examData.questions.length;
            const progressPercentage = (answeredCount / totalQuestions) * 100;
            
            examProgress.style.width = `${progressPercentage}%`;
            examProgressText.textContent = `${answeredCount}/${totalQuestions} Ø¥Ø¬Ø§Ø¨Ø©`;
            
            // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø¨Ø©
            if (progressPercentage < 30) {
                examProgress.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
            } else if (progressPercentage < 70) {
                examProgress.style.background = 'linear-gradient(90deg, #f39c12, #e67e22)';
            } else if (progressPercentage < 100) {
                examProgress.style.background = 'linear-gradient(90deg, #3498db, #2980b9)';
            } else {
                examProgress.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
            }
        }

        // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ÙˆØªØµØ­ÙŠØ­Ù‡
        function submitExam() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„ÙŠÙ‡Ø§
            const unansweredQuestions = examState.answers.filter(answer => answer === null).length;
            
            if (unansweredQuestions > 0) {
                if (!confirm(`âš ï¸ Ù„Ù… ØªÙ‚Ù… Ø¨Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ ${unansweredQuestions} Ø³Ø¤Ø§Ù„Ø§Ù‹. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù…Ø¹ Ø°Ù„ÙƒØŸ`)) {
                    return;
                }
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            let score = 0;
            const mistakes = [];
            
            examData.questions.forEach((q, index) => {
                const studentAnswer = examState.answers[index];
                const correctAnswer = q.correctAnswer === 'ØµÙˆØ§Ø¨' ? 1 : 0;
                
                if (studentAnswer === correctAnswer) {
                    score++;
                } else if (studentAnswer !== null) {
                    mistakes.push({
                        questionNumber: index + 1,
                        question: q.question,
                        studentAnswer: studentAnswer === 1 ? 'ØµÙˆØ§Ø¨' : 'Ø®Ø·Ø£',
                        correctAnswer: q.correctAnswer
                    });
                } else {
                    mistakes.push({
                        questionNumber: index + 1,
                        question: q.question,
                        studentAnswer: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©",
                        correctAnswer: q.correctAnswer
                    });
                }
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            showResults(score, mistakes);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            examState.examCompleted = true;
            
            // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ÙˆØ¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            examSection.classList.add('hidden');
            resultSection.classList.remove('hidden');
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„
            addToExamHistory(score, mistakes.length);
            
            // Ù…Ù†Ø¹ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
            disableFurtherAttempts();
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function showResults(score, mistakes) {
            const percentage = (score / examData.questions.length) * 100;
            let grade = '';
            let gradeColor = '';
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±
            if (percentage >= 90) {
                grade = 'Ø§Ù…ØªÙŠØ§Ø²';
                gradeColor = '#27ae60';
            } else if (percentage >= 80) {
                grade = 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹';
                gradeColor = '#3498db';
            } else if (percentage >= 70) {
                grade = 'Ø¬ÙŠØ¯';
                gradeColor = '#f39c12';
            } else if (percentage >= 60) {
                grade = 'Ù…Ù‚Ø¨ÙˆÙ„';
                gradeColor = '#e67e22';
            } else {
                grade = 'Ø¶Ø¹ÙŠÙ';
                gradeColor = '#e74c3c';
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚
            const timeTaken = examState.startTime ? 
                Math.round((new Date() - examState.startTime) / 1000) : 0;
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            
            let resultHTML = `
                <div class="result">
                    <h2>ğŸ“ Ù†ØªÙŠØ¬Ø© Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</h2>
                    <p><strong>Ø§Ù„ØµÙ:</strong> ${examData.grade}</p>
                    <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†:</strong> ${examData.type}</p>
                    <p><strong>Ø§Ù„ÙƒÙˆØ¯:</strong> <span style="background:#2c3e50;color:white;padding:2px 8px;border-radius:4px;">${examState.studentCode}</span></p>
                    <div class="score">${score}/${examData.questions.length}</div>
                    <p><strong>Ø§Ù„Ù†Ø³Ø¨Ø©:</strong> <span style="color:${gradeColor};font-weight:bold">${percentage.toFixed(1)}%</span></p>
                    <p><strong>Ø§Ù„ØªÙ‚Ø¯ÙŠØ±:</strong> <span style="color:${gradeColor};font-weight:bold;font-size:18px">${grade}</span></p>
                    <p><strong>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚:</strong> ${minutes} Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ ${seconds} Ø«Ø§Ù†ÙŠØ©</p>
                    <div style="margin-top:15px;padding:10px;background:#e8f6f3;border-radius:5px;">
                        <p>${score === examData.questions.length ? 'ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­' : 
                           score >= examData.questions.length * 0.6 ? 'ğŸ‘ Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ØŒ Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©' : 
                           'ğŸ“š ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø±ÙˆØ³ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰'}</p>
                    </div>
                </div>
            `;
            
            if (mistakes.length > 0) {
                let mistakesHTML = '<div class="mistakes"><h3>ğŸ“ Ø§Ù„ØªØµØ­ÙŠØ­ ÙˆØ§Ù„Ø£Ø®Ø·Ø§Ø¡:</h3>';
                
                mistakes.forEach((mistake) => {
                    const isCorrect = mistake.studentAnswer === mistake.correctAnswer;
                    
                    mistakesHTML += `
                        <div class="mistake-item">
                            <p><strong>Ø³ ${mistake.questionNumber}:</strong> ${mistake.question}</p>
                            <p>Ø¥Ø¬Ø§Ø¨ØªÙƒ: <span class="${isCorrect ? 'correct-answer' : 'wrong-answer'}">${mistake.studentAnswer}</span></p>
                            ${!isCorrect ? `<p>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: <span class="correct-answer">${mistake.correctAnswer}</span></p>` : ''}
                        </div>
                    `;
                });
                
                mistakesHTML += '</div>';
                resultHTML += mistakesHTML;
            }
            
            resultContent.innerHTML = resultHTML;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ù‚Øª
        function updateTimer() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            timerElement.textContent = `${hours}:${minutes}:${seconds}`;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆÙ‚Øª Ø¨Ø¹Ø¯ Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„
            if (now.getHours() >= 0 && now.getHours() < 6) {
                if (!examState.examCompleted && examSection.classList.contains('hidden') === false) {
                    alert("â° Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† (Ù„Ø§ ÙŠÙØªØ­ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„)");
                    submitExam();
                }
            }
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function resetExam() {
            examState = {
                studentCode: '',
                answers: new Array(examData.questions.length).fill(null),
                startTime: null,
                examCompleted: false,
                deviceId: examState.deviceId,
                examDuration: 1800
            };
            
            studentCodeInput.value = '';
            codeProgress.style.width = '0%';
            codeError.textContent = '';
            startExamBtn.disabled = true;
            studentCodeInput.disabled = false;
            studentCodeInput.focus();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateStatistics();
        }

        // ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… =====
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ø¬Ù‡Ø§Ø² ÙØ±ÙŠØ¯ Ù…Ø¹Ù‚Ø¯
        function generateAdvancedDeviceId() {
            // Ø¬Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ø¹Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²
            const components = [
                navigator.userAgent,
                navigator.platform,
                navigator.language,
                navigator.hardwareConcurrency || 'unknown',
                screen.width + 'x' + screen.height + 'x' + screen.colorDepth,
                new Date().getTimezoneOffset(),
                Math.random().toString(36).substring(2, 18),
                Math.random().toString(36).substring(2, 18),
                performance.now().toString()
            ];
            
            // Ø¯Ù…Ø¬Ù‡Ø§ ÙˆØ¥Ù†Ø´Ø§Ø¡ hash ÙØ±ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø¨Ø³ÙŠØ·Ø©
            const combined = components.join('||');
            let hash = 0;
            
            for (let i = 0; i < combined.length; i++) {
                const char = combined.charCodeAt(i);
                hash = ((hash << 9) - hash) + char;
                hash = hash & 0x7FFFFFFF; // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø¹Ø¯Ø¯ Ù…ÙˆØ¬Ø¨
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ø¯Ø¦Ø© Ù…Ù…ÙŠØ²Ø© ÙˆØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ
            const timestamp = Date.now().toString(36).toUpperCase();
            const randomPart = Math.random().toString(36).substring(2, 12).toUpperCase();
            const checksum = (hash % 10000).toString().padStart(4, '0');
            
            return `NGS6-${hash.toString(36).toUpperCase()}-${timestamp}-${randomPart}-${checksum}`;
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ ØªØ®Ø²ÙŠÙ† ÙØ±ÙŠØ¯ Ù„ÙƒÙ„ ÙƒÙˆØ¯
        function generateCodeStorageKey(code) {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… hash Ù…Ø¹Ù‚Ø¯ Ù„Ù„Ù…ÙØªØ§Ø­ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø­ (salt)
            const salt = "NGS_EXAM_SYSTEM_2024_SALT";
            const data = code + salt + examState.deviceId;
            
            let hash = 0;
            for (let i = 0; i < data.length; i++) {
                const char = data.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & 0x7FFFFFFF;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠ ÙˆØ¬Ø²Ø¡ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
            const timestamp = Date.now();
            const randomSuffix = Math.random().toString(36).substring(2, 10).toUpperCase();
            
            return `EXAM_GRADE6_${hash}_${timestamp}_${randomSuffix}`;
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
        function getExamAttempts() {
            const deviceKey = `NGS_DEVICE_RECORDS_${examState.deviceId}`;
            const storedData = localStorage.getItem(deviceKey);
            
            if (!storedData) {
                return {
                    deviceId: examState.deviceId,
                    deviceAttempts: 0,
                    usedCodes: [],
                    lastAttempt: null,
                    creationDate: new Date().toISOString()
                };
            }
            
            try {
                const parsedData = JSON.parse(storedData);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ…Ø·Ø§Ø¨Ù‚Ø© Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø§Ø²
                if (parsedData.deviceId !== examState.deviceId) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ø®ØªÙ„ÙÙ‹Ø§ØŒ Ù†Ø¨Ø¯Ø£ Ø³Ø¬Ù„Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ù‹Ø§
                    return {
                        deviceId: examState.deviceId,
                        deviceAttempts: 0,
                        usedCodes: [],
                        lastAttempt: null,
                        creationDate: new Date().toISOString()
                    };
                }
                
                return parsedData;
            } catch (e) {
                console.error('Error parsing attempts data:', e);
                return {
                    deviceId: examState.deviceId,
                    deviceAttempts: 0,
                    usedCodes: [],
                    lastAttempt: null,
                    creationDate: new Date().toISOString()
                };
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù…Ù‹Ø§ Ù…Ù† Ù‚Ø¨Ù„
        function isCodeAlreadyUsed(code) {
            const attempts = getExamAttempts();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø²
            if (attempts.usedCodes.includes(code)) {
                return true;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ© Ù„Ù„ÙƒÙˆØ¯ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø´ÙØ±)
            const codeHash = btoa(encodeURIComponent(code + examState.deviceId)).replace(/=/g, '');
            const codeRecords = localStorage.getItem(`CODE_${codeHash}_RECORDS`);
            
            if (codeRecords) {
                try {
                    const records = JSON.parse(codeRecords);
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²
                    return records.some(record => record.deviceId === examState.deviceId);
                } catch (e) {
                    return false;
                }
            }
            
            return false;
        }

        // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function registerNewAttempt(code) {
            const attempts = getExamAttempts();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
            if (attempts.deviceAttempts >= 2) {
                return {
                    success: false,
                    message: "âŒ Ù„Ù‚Ø¯ Ø§Ø³ØªØ®Ø¯Ù…Øª Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø§ØªÙ Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù…Ø±ØªÙŠÙ† Ø¨Ø§Ù„ÙØ¹Ù„."
                };
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù…Ù‹Ø§
            if (isCodeAlreadyUsed(code)) {
                return {
                    success: false,
                    message: "âŒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø§ØªÙ"
                };
            }
            
            // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
            attempts.deviceAttempts += 1;
            attempts.lastAttempt = new Date().toISOString();
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            if (!attempts.usedCodes.includes(code)) {
                attempts.usedCodes.push(code);
            }
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
            localStorage.setItem(`NGS_DEVICE_RECORDS_${examState.deviceId}`, JSON.stringify(attempts));
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ù…ÙØµÙ„ Ù„Ù„ÙƒÙˆØ¯ Ù…Ø¹ Ø±Ù…ÙˆØ² Ø£Ù…Ø§Ù† Ù…Ù…ÙŠØ²Ø©
            const codeRecord = {
                code: code,
                deviceId: examState.deviceId,
                examDate: new Date().toISOString(),
                examTitle: examData.title,
                examGrade: examData.grade,
                examType: examData.type,
                // Ø±Ù…ÙˆØ² ØªØªØ¨Ø¹ Ø£Ù…Ù†ÙŠØ© Ù…Ù…ÙŠØ²Ø©
                recordId: `REC-${Date.now()}-${Math.random().toString(36).substring(2, 12).toUpperCase()}`,
                securityToken: `TOKEN-${Math.random().toString(36).substring(2, 18)}-${Date.now()}`,
                verificationCode: `VER-${Math.random().toString(36).substring(2, 8).toUpperCase()}`
            };
            
            // Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„
            const storageKey = generateCodeStorageKey(code);
            localStorage.setItem(storageKey, JSON.stringify(codeRecord));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„ÙƒÙˆØ¯ (Ù…Ø´ÙØ±)
            updateCodeGlobalRecords(code, codeRecord);
            
            return {
                success: true,
                message: "âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­"
            };
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ÙƒÙˆØ¯ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ´ÙÙŠØ± Ø¨Ø³ÙŠØ·)
        function updateCodeGlobalRecords(code, record) {
            const codeHash = btoa(encodeURIComponent(code + examState.deviceId)).replace(/=/g, '');
            const globalKey = `CODE_${codeHash}_RECORDS`;
            let existingRecords = [];
            
            try {
                const stored = localStorage.getItem(globalKey);
                if (stored) {
                    existingRecords = JSON.parse(stored);
                }
            } catch (e) {
                existingRecords = [];
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ø®ØªØµØ±)
            existingRecords.push({
                deviceId: record.deviceId,
                date: record.examDate,
                recordId: record.recordId,
                grade: record.examGrade
            });
            
            // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
            localStorage.setItem(globalKey, JSON.stringify(existingRecords));
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
        function addToExamHistory(score, mistakesCount) {
            const examHistory = {
                code: examState.studentCode,
                deviceId: examState.deviceId,
                score: score,
                totalQuestions: examData.questions.length,
                percentage: ((score / examData.questions.length) * 100).toFixed(1),
                mistakes: mistakesCount,
                date: new Date().toISOString(),
                examTitle: examData.title,
                examGrade: examData.grade,
                examType: examData.type,
                // Ù…ÙØªØ§Ø­ ØªØ®Ø²ÙŠÙ† ÙØ±ÙŠØ¯ Ù…Ø¹ Ø±Ù…Ø² Ø£Ù…Ø§Ù†
                storageKey: `RESULT_${Date.now()}_${Math.random().toString(36).substring(2, 12)}`,
                securityStamp: `STAMP-${Math.random().toString(36).substring(2, 10).toUpperCase()}`
            };
            
            // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ù…ÙØªØ§Ø­ ÙØ±ÙŠØ¯
            localStorage.setItem(examHistory.storageKey, JSON.stringify(examHistory));
        }

        // Ù…Ù†Ø¹ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
        function disableFurtherAttempts() {
            const attempts = getExamAttempts();
            if (attempts.deviceAttempts >= 2) {
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                setTimeout(() => {
                    alert("âš ï¸ Ù„Ù‚Ø¯ Ø§Ø³ØªØ®Ø¯Ù…Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª (2 Ù…Ø­Ø§ÙˆÙ„Ø©) Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².");
                }, 1000);
            }
        }
    </script>
</body>
</html>p