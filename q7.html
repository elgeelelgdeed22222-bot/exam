<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø§ØµØ© - Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ù„Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 10px;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, var(--secondary-color), #34495e);
            color: white;
            padding: 20px 15px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            border: 3px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color), var(--warning-color));
        }
        
        .header h1 {
            font-size: 20px;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        
        .header h2 {
            font-size: 18px;
            color: #f1c40f;
            background: rgba(0, 0, 0, 0.4);
            padding: 10px 20px;
            border-radius: 8px;
            display: inline-block;
            margin: 8px 0;
            position: relative;
            z-index: 1;
            border: 2px solid #f1c40f;
        }
        
        .header h3 {
            font-size: 15px;
            margin-top: 12px;
            color: #ecf0f1;
            position: relative;
            z-index: 1;
            font-weight: normal;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            border: 1px solid #e0e0e0;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .container:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .code-input-section {
            text-align: center;
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
        }
        
        .code-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
            max-width: 320px;
            margin: 20px 0;
        }
        
        .code-input {
            width: 100%;
            padding: 15px;
            font-size: 20px;
            text-align: center;
            border: 3px solid var(--primary-color);
            border-radius: 10px;
            direction: ltr;
            background-color: #f8f9fa;
            letter-spacing: 3px;
            font-weight: bold;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }
        
        .code-input:focus {
            outline: none;
            border-color: var(--success-color);
            box-shadow: 0 0 0 4px rgba(46, 204, 113, 0.2);
            transform: scale(1.02);
        }
        
        .code-input::placeholder {
            letter-spacing: normal;
            font-size: 16px;
        }
        
        .input-label {
            position: absolute;
            top: -10px;
            right: 15px;
            background: var(--primary-color);
            color: white;
            padding: 3px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .btn {
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
            position: relative;
            overflow: hidden;
            font-weight: bold;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(52, 152, 219, 0.4);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        
        .question {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: linear-gradient(135deg, #f9f9f9, #ffffff);
            font-size: 15px;
            transition: all 0.3s;
            position: relative;
        }
        
        .question:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border-color: var(--primary-color);
        }
        
        .question-number {
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 16px;
            padding-bottom: 8px;
            border-bottom: 3px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .question-number::before {
            content: 'Ø³';
            background: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 14px;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .option {
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid #e0e0e0;
            background: white;
            text-align: right;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }
        
        .option:hover {
            transform: translateY(-2px);
            border-color: var(--primary-color);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.2);
        }
        
        .option.selected {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-color: var(--primary-color);
            border-width: 3px;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .option.selected::before {
            content: 'âœ“';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--success-color);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, var(--success-color), #219653);
            display: block;
            margin: 30px auto;
            width: 280px;
            font-size: 18px;
            padding: 16px;
        }
        
        .submit-btn:hover {
            background: linear-gradient(135deg, #219653, #1e8449);
        }
        
        .result {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #e8f6f3, #d4efdf);
            border-radius: 15px;
            margin-top: 25px;
            font-size: 15px;
            border: 3px solid var(--success-color);
            position: relative;
            overflow: hidden;
        }
        
        .result::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--success-color), #2ecc71);
        }
        
        .score {
            font-size: 36px;
            color: var(--success-color);
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            position: relative;
            display: inline-block;
            padding: 0 20px;
        }
        
        .score::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 10%;
            right: 10%;
            height: 4px;
            background: linear-gradient(90deg, transparent, var(--success-color), transparent);
        }
        
        .mistakes {
            text-align: right;
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #fef9e7, #fcf3cf);
            border-radius: 12px;
            font-size: 14px;
            border: 2px solid var(--warning-color);
        }
        
        .mistake-item {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            background: white;
            border-right: 5px solid var(--danger-color);
            transition: transform 0.2s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .mistake-item:hover {
            transform: translateX(-10px);
        }
        
        .correct-answer {
            color: var(--success-color);
            font-weight: bold;
            background-color: #d4efdf;
            padding: 5px 12px;
            border-radius: 6px;
            display: inline-block;
            margin: 5px 0;
            border: 1px solid #a3e4d7;
        }
        
        .wrong-answer {
            color: var(--danger-color);
            font-weight: bold;
            background-color: #fadbd8;
            padding: 5px 12px;
            border-radius: 6px;
            display: inline-block;
            margin: 5px 0;
            border: 1px solid #f5b7b1;
        }
        
        .timer {
            position: fixed;
            top: 15px;
            left: 15px;
            background: linear-gradient(135deg, var(--secondary-color), #34495e);
            color: white;
            padding: 12px 18px;
            border-radius: 10px;
            font-size: 15px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Courier New', monospace;
            min-width: 140px;
        }
        
        .timer::before {
            content: 'â±ï¸';
            font-size: 18px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .error-message {
            color: var(--danger-color);
            margin-top: 15px;
            font-size: 14px;
            text-align: center;
            padding: 12px;
            background: linear-gradient(135deg, #fadbd8, #f5b7b1);
            border-radius: 8px;
            border: 2px solid var(--danger-color);
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .info-message {
            color: var(--primary-color);
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
            padding: 10px;
            background: linear-gradient(135deg, #d6eaf8, #aed6f1);
            border-radius: 8px;
            border: 2px solid var(--primary-color);
        }
        
        .success-message {
            color: var(--success-color);
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
            padding: 10px;
            background: linear-gradient(135deg, #d4efdf, #a3e4d7);
            border-radius: 8px;
            border: 2px solid var(--success-color);
            animation: fadeIn 1s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hidden {
            display: none;
        }
        
        .attempt-info {
            font-size: 13px;
            color: #7f8c8d;
            margin-top: 15px;
            text-align: center;
            padding: 10px;
            background: linear-gradient(135deg, #f8f9fa, #e8e9ea);
            border-radius: 8px;
            border: 2px dashed #bdc3c7;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: #ecf0f1;
            border-radius: 6px;
            margin: 15px 0;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
            width: 0%;
            transition: width 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
        }
        
        .progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        .exam-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa, #e8e9ea);
            border-radius: 12px;
            border: 2px solid #e0e0e0;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .stat-item:hover {
            transform: translateY(-3px);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 13px;
            color: #7f8c8d;
        }
        
        .exam-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-radius: 10px;
            border: 2px solid var(--primary-color);
        }
        
        .grade-badge {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .time-info {
            font-size: 14px;
            color: var(--secondary-color);
            font-weight: bold;
        }
        
        .result-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }
        
        .action-btn {
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .action-btn.primary {
            background: var(--primary-color);
            color: white;
        }
        
        .action-btn.secondary {
            background: transparent;
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 18px;
            }
            
            .header h2 {
                font-size: 16px;
                padding: 8px 15px;
            }
            
            .question {
                font-size: 14px;
                padding: 15px;
            }
            
            .options {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .option {
                padding: 12px;
                font-size: 13px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 14px;
                width: 100%;
                max-width: 250px;
            }
            
            .timer {
                position: static;
                margin: 10px auto;
                width: calc(100% - 30px);
                max-width: 200px;
                justify-content: center;
            }
            
            .exam-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .result-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .action-btn {
                width: 100%;
                max-width: 250px;
            }
            
            .container {
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 16px;
            }
            
            .header h2 {
                font-size: 14px;
            }
            
            .code-input {
                font-size: 18px;
                padding: 12px;
            }
            
            .score {
                font-size: 28px;
            }
            
            .exam-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="timer" id="timer">
        <span id="currentTime">--:--:--</span>
    </div>
    
    <div class="header">
        <h1>Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø§ØµØ©</h1>
        <h2>Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ù„Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</h2>
        <h3>Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯ - Ø§Ù…ØªØ­Ø§Ù† Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¢Ù…Ù†</h3>
    </div>
    
    <div class="container code-input-section" id="codeSection">
        <p style="font-size: 16px; margin-bottom: 10px; color: var(--secondary-color);">Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù… Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</p>
        
        <div class="code-input-wrapper">
            <div class="input-label">ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</div>
            <input type="text" id="studentCode" class="code-input" maxlength="9" 
                   placeholder="" pattern="\d*" inputmode="numeric" autocomplete="off">
        </div>
        
        <div class="progress-bar">
            <div class="progress" id="codeProgress"></div>
        </div>
        
        <p class="info-message">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù„ÙƒÙ„ ÙƒÙˆØ¯ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²</p>
        
        <button class="btn" id="startExamBtn">
            <span id="btnText">Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</span>
        </button>
        
        <div class="error-message" id="codeError"></div>
        <div class="attempt-info" id="attemptInfo"></div>
        
        <div class="exam-stats">
            <div class="stat-item">
                <div class="stat-value" id="deviceAttempts">0</div>
                <div class="stat-label">Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="usedCodes">0</div>
                <div class="stat-label">Ø£ÙƒÙˆØ§Ø¯ Ù…Ø³ØªØ®Ø¯Ù…Ø©</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="examTime">30:00</div>
                <div class="stat-label">Ù…Ø¯Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="questionsCount">10</div>
                <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</div>
            </div>
        </div>
    </div>
    
    <div class="container hidden" id="examSection">
        <div class="exam-info">
            <div class="grade-badge">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</div>
            <div class="time-info">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="remainingTime">30:00</span></div>
        </div>
        
        <div id="questionsContainer"></div>
        
        <div class="progress-bar">
            <div class="progress" id="examProgress"></div>
        </div>
        <p class="info-message" id="examProgressText">0/10 Ø¥Ø¬Ø§Ø¨Ø©</p>
        
        <button class="btn submit-btn" id="submitExamBtn">
            <span>Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ÙˆØªØµØ­ÙŠØ­ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</span>
        </button>
    </div>
    
    <div class="container hidden" id="resultSection">
        <div id="resultContent"></div>
        
        <div class="result-actions">
            <button class="action-btn primary" id="backToHomeBtn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button class="action-btn secondary" id="printResultBtn">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
        </div>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ
        const examData = {
            title: "Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ù„Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ",
            grade: "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ",
            type: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯",
            duration: 1800, // 30 Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
            questions: [
                {
                    question: "Ù…Ù† Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ø§Ù„ØªÙŠ ØªØ¤Ø«Ø± Ø¨Ø§Ù„Ø³Ù„Ø¨ Ø¹Ù„Ù‰ Ø£Ø´Ø¬Ø§Ø± Ø§Ù„Ù…Ø§Ù†Ø¬Ø±ÙˆÙ ...........",
                    options: ["Ø§Ù„Ø±Ø¹ÙŠ Ø§Ù„Ø¬Ø§Ø¦Ø±", "Ø§Ù„ØªÙˆØ³Ø¹ Ø§Ù„Ø¹Ù…Ø±Ø§Ù†ÙŠ", "Ø§Ù„ØªÙ†Ù…ÙŠØ© Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ©", "Ø§Ù„ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø®ÙŠØ©"],
                    correctAnswer: 3
                },
                {
                    question: "ØªÙˆØ¬Ø¯ Ø§Ù„Ø´Ø¹Ø§Ø¨ Ø§Ù„Ù…Ø±Ø¬Ø§Ù†ÙŠØ© ÙÙŠ Ù…Ø¹Ø¸Ù… Ø§Ù„Ø³ÙˆØ§Ø­Ù„ ........... Ø§Ù„Ù‚Ø§Ø±Ø© Ø¥ÙØ±ÙŠÙ‚ÙŠØ§.",
                    options: ["Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©", "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", "Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©", "Ø§Ù„ØºØ±Ø¨ÙŠØ©"],
                    correctAnswer: 1
                },
                {
                    question: "ØªØ´ØªÙ‡Ø± Ù…ØµØ± Ø¨ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø´Ø¹Ø§Ø¨ Ø§Ù„Ù…Ø±Ø¬Ø§Ù†ÙŠØ© Ø®Ø§ØµØ© ÙÙŠ Ù…Ø¯ÙŠÙ†Ø© ...........",
                    options: ["Ù…Ø·Ø±ÙˆØ­", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ø§Ù„ØºØ±Ø¯Ù‚Ø©", "Ø§Ù„Ø³ÙˆÙŠØ³"],
                    correctAnswer: 2
                },
                {
                    question: "Ù…Ù† Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© Ø§Ù„ØªÙŠ ØªØ¯Ù…Ø± Ø§Ù„Ø´Ø¹Ø§Ø¨ Ø§Ù„Ù…Ø±Ø¬Ø§Ù†ÙŠØ© ...........",
                    options: ["Ø§Ù„ÙÙŠØ¶Ø§Ù†Ø§Øª", "Ø§Ù„ØªÙ„ÙˆØ«", "Ø§Ù„Ù…Ù†Ø§Ø®", "Ø§Ù„Ø³Ø¯ÙˆØ¯"],
                    correctAnswer: 1
                },
                {
                    question: "Ù…Ù† Ø§Ù„Ø¨Ø­ÙŠØ±Ø§Øª Ø§Ù„Ù…Ø§Ù„Ø­Ø© ÙÙŠ Ø¥ÙØ±ÙŠÙ‚ÙŠØ§ Ø¨Ø­ÙŠØ±Ø© ...........",
                    options: ["ÙÙŠÙƒØªÙˆØ±ÙŠØ§", "Ø§Ù„Ø¨Ø±Ø¯ÙˆÙŠÙ„", "ØªÙ†Ø¬Ø§Ù†ÙŠÙ‚Ø§", "ØªØ´Ø§Ø¯"],
                    correctAnswer: 1
                },
                {
                    question: "Ù…Ø­Ù…ÙŠØ© Ø£Ø±ÙƒÙŠÙ† ØªØ¹ØªØ¨Ø± Ø£Ø´Ù‡Ø± Ø§Ù„Ù…Ø­Ù…ÙŠØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© ÙÙŠ Ø¯ÙˆÙ„Ø© ...........",
                    options: ["Ù…ØµØ±", "Ø§Ù„ÙƒÙˆÙ†ØºÙˆ", "ÙƒÙŠÙ†ÙŠØ§", "Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§"],
                    correctAnswer: 3
                },
                {
                    question: "ØªÙ†Ù‚Ù„ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø¨ÙˆØ¶ÙˆØ­ ÙÙŠ Ù†Ø¸Ø§Ù… ...........",
                    options: ["Ø§Ù„Ø­Ø´Ø§Ø¦Ø´ Ø§Ù„Ø¨Ø³ØªØ§Ù†ÙŠØ©", "Ø§Ù„Ø­Ø´Ø§Ø¦Ø´ Ø§Ù„Ø­Ø§Ø±Ø©", "Ø§Ù„Ø­Ø´Ø§Ø¦Ø´ Ø§Ù„Ù…Ø¹ØªØ¯Ù„Ø©", "Ø§Ù„ØµØ­Ø§Ø±ÙŠ Ø§Ù„Ø­Ø§Ø±Ø©"],
                    correctAnswer: 3
                },
                {
                    question: "Ø£ÙŠ Ù…Ù† Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© ØªØªØ­Ù…Ù„ Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„ØµØ­Ø±Ø§ÙˆÙŠØ© Ø§Ù„Ù‚Ø§Ø³ÙŠØ© ...........",
                    options: ["Ø§Ù„Ø£Ø¨Ù‚Ø§Ø±", "Ø§Ù„Ø¥Ø¨Ù„", "Ø§Ù„Ø¬Ø§Ù…ÙˆØ³", "Ø§Ù„Ø¹Ù‚Ø§Ø±Ø¨"],
                    correctAnswer: 1
                },
                {
                    question: "ØªÙ…ØªØ¯ Ø­Ø´Ø§Ø¦Ø´ Ø¨ÙŠÙ† Ø¯Ø§Ø¦Ø±ØªÙŠ Ø¹Ø±Ø¶ (10 - 18) Ø´Ù…Ø§Ù„ ÙˆØ¬Ù†ÙˆØ¨ Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø§Ø³ØªÙˆØ§Ø¡ ...........",
                    options: ["Ø§Ù„Ø³Ø§ÙØ§Ù†Ø§", "Ø§Ù„Ø¥Ø³ØªØ¨Ø³", "Ø§Ù„Ù…Ø¹ØªØ¯Ù„Ø©", "Ø§Ù„ØªÙ†Ø¯Ø±Ø§"],
                    correctAnswer: 0
                },
                {
                    question: "ØªØ³Ù‚Ø· Ø§Ù„Ø£Ù…Ø·Ø§Ø± ÙÙŠ Ù†Ø·Ø§Ù‚ Ø­Ø´Ø§Ø¦Ø´ Ø§Ù„Ø³Ø§ÙØ§Ù†Ø§ ÙÙŠ ÙØµÙ„ ...........",
                    options: ["Ø§Ù„ØµÙŠÙ", "Ø§Ù„Ø´ØªØ§Ø¡", "Ø§Ù„Ø±Ø¨ÙŠØ¹", "Ø§Ù„Ø®Ø±ÙŠÙ"],
                    correctAnswer: 0
                }
            ]
        };

        // Ø¹Ù†Ø§ØµØ± DOM
        const elements = {
            codeSection: document.getElementById('codeSection'),
            examSection: document.getElementById('examSection'),
            resultSection: document.getElementById('resultSection'),
            studentCodeInput: document.getElementById('studentCode'),
            startExamBtn: document.getElementById('startExamBtn'),
            submitExamBtn: document.getElementById('submitExamBtn'),
            questionsContainer: document.getElementById('questionsContainer'),
            resultContent: document.getElementById('resultContent'),
            codeError: document.getElementById('codeError'),
            attemptInfo: document.getElementById('attemptInfo'),
            timer: document.getElementById('timer'),
            currentTime: document.getElementById('currentTime'),
            codeProgress: document.getElementById('codeProgress'),
            examProgress: document.getElementById('examProgress'),
            examProgressText: document.getElementById('examProgressText'),
            backToHomeBtn: document.getElementById('backToHomeBtn'),
            printResultBtn: document.getElementById('printResultBtn'),
            deviceAttempts: document.getElementById('deviceAttempts'),
            usedCodes: document.getElementById('usedCodes'),
            examTime: document.getElementById('examTime'),
            questionsCount: document.getElementById('questionsCount'),
            remainingTime: document.getElementById('remainingTime'),
            btnText: document.getElementById('btnText')
        };

        // Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        let examState = {
            studentCode: '',
            answers: new Array(examData.questions.length).fill(null),
            startTime: null,
            examCompleted: false,
            deviceId: null,
            examTimer: null,
            timeRemaining: examData.duration
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            // ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ÙØ±ÙŠØ¯
            examState.deviceId = generateAdvancedDeviceId();
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            updateExamInfo();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
            checkTimeRestriction();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateStatistics();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø§Ù†Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯
            setupCodeInput();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            setupButtons();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ø¹Ø§Ù…
            updateClock();
            setInterval(updateClock, 1000);
        });

        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function updateExamInfo() {
            const minutes = Math.floor(examData.duration / 60);
            const seconds = examData.duration % 60;
            elements.examTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            elements.questionsCount.textContent = examData.questions.length;
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø§Ù†Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯
        function setupCodeInput() {
            elements.studentCodeInput.addEventListener('input', function() {
                // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙÙ‚Ø·
                this.value = this.value.replace(/[^0-9]/g, '');
                
                // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                const progress = (this.value.length / 9) * 100;
                elements.codeProgress.style.width = `${progress}%`;
                
                // ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø§Ù„Ø´Ø±ÙŠØ·
                if (this.value.length === 9) {
                    elements.codeError.textContent = '';
                    elements.startExamBtn.disabled = false;
                    elements.codeProgress.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
                    elements.btnText.textContent = 'Ø§Ù†Ù‚Ø± Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†';
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙƒÙˆØ¯
                    if (isCodeAlreadyUsed(this.value)) {
                        elements.codeError.textContent = 'âš ï¸ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²';
                        elements.codeProgress.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
                        elements.btnText.textContent = 'Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹';
                        elements.startExamBtn.disabled = true;
                    }
                } else {
                    elements.startExamBtn.disabled = true;
                    elements.codeProgress.style.background = 'linear-gradient(90deg, #3498db, #2ecc71)';
                    elements.btnText.textContent = 'Ø£Ø¯Ø®Ù„ 9 Ø£Ø±Ù‚Ø§Ù…';
                    
                    if (this.value.length > 0) {
                        elements.codeError.textContent = 'Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·';
                    } else {
                        elements.codeError.textContent = '';
                    }
                }
            });
            
            // ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            elements.studentCodeInput.focus();
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØµØ§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            elements.studentCodeInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && this.value.length === 9 && !elements.startExamBtn.disabled) {
                    startExam();
                }
            });
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        function setupButtons() {
            // Ø²Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            elements.startExamBtn.addEventListener('click', startExam);
            
            // Ø²Ø± Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            elements.submitExamBtn.addEventListener('click', submitExam);
            
            // Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            elements.backToHomeBtn.addEventListener('click', function() {
                elements.resultSection.classList.add('hidden');
                elements.codeSection.classList.remove('hidden');
                resetExam();
            });
            
            // Ø²Ø± Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©
            elements.printResultBtn.addEventListener('click', function() {
                printResult();
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStatistics() {
            const attempts = getExamAttempts();
            elements.deviceAttempts.textContent = attempts.deviceAttempts;
            elements.usedCodes.textContent = attempts.usedCodes.length;
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
            if (attempts.deviceAttempts > 0) {
                elements.attemptInfo.innerHTML = `
                    <strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²:</strong> ØªÙ…Øª ${attempts.deviceAttempts} Ù…Ø­Ø§ÙˆÙ„Ø© Ø³Ø§Ø¨Ù‚Ø©
                    ${attempts.deviceAttempts >= 2 ? '<span style="color:#e74c3c">(Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 2 Ù…Ø­Ø§ÙˆÙ„Ø©)</span>' : ''}
                `;
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¹Ø©
        function updateClock() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            elements.currentTime.textContent = `${hours}:${minutes}:${seconds}`;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆÙ‚Øª Ø¨Ø¹Ø¯ Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„
            if (now.getHours() >= 0 && now.getHours() < 6) {
                if (!examState.examCompleted && elements.examSection.classList.contains('hidden') === false) {
                    alert("â° Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† (Ù„Ø§ ÙŠÙØªØ­ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„)");
                    submitExam();
                }
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„ÙˆÙ‚Øª
        function checkTimeRestriction() {
            const now = new Date();
            const currentHour = now.getHours();
            
            if (currentHour >= 0 && currentHour < 6) {
                elements.codeError.innerHTML = `
                    â° <strong>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠÙ‹Ø§</strong><br>
                    Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ: ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}<br>
                    ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© 6 ØµØ¨Ø§Ø­Ù‹Ø§
                `;
                elements.startExamBtn.disabled = true;
                elements.studentCodeInput.disabled = true;
                return true;
            }
            return false;
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function startExam() {
            if (checkTimeRestriction()) return;
            
            const code = elements.studentCodeInput.value.trim();
            
            if (code.length !== 9) {
                elements.codeError.textContent = 'Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù… Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©';
                elements.studentCodeInput.focus();
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙˆØ¯ Ù‚Ø¯ Ø§Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø¨Ù„ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø§ØªÙ
            if (isCodeAlreadyUsed(code)) {
                elements.codeError.textContent = 'âŒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø§ØªÙ';
                elements.studentCodeInput.value = '';
                elements.studentCodeInput.focus();
                elements.codeProgress.style.width = '0%';
                return;
            }
            
            // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
            const attemptResult = registerNewAttempt(code);
            
            if (!attemptResult.success) {
                elements.codeError.textContent = attemptResult.message;
                return;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateStatistics();
            
            // Ø­ÙØ¸ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨
            examState.studentCode = code;
            examState.startTime = new Date();
            examState.timeRemaining = examData.duration;
            
            // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„ÙƒÙˆØ¯ ÙˆØ¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            elements.codeSection.classList.add('hidden');
            elements.examSection.classList.remove('hidden');
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            loadQuestions();
            
            // Ø¨Ø¯Ø¡ Ù…Ø¤Ù‚Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            startExamTimer();
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            updateExamProgress();
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        function loadQuestions() {
            elements.questionsContainer.innerHTML = '';
            
            examData.questions.forEach((q, index) => {
                const questionElement = document.createElement('div');
                questionElement.className = 'question';
                questionElement.id = `question-${index}`;
                
                let optionsHTML = '';
                q.options.forEach((option, optIndex) => {
                    optionsHTML += `
                        <div class="option" data-question="${index}" data-option="${optIndex}">
                            ${option}
                        </div>
                    `;
                });
                
                questionElement.innerHTML = `
                    <div class="question-number">${index + 1}: ${q.question}</div>
                    <div class="options">${optionsHTML}</div>
                `;
                
                elements.questionsContainer.appendChild(questionElement);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    const questionIndex = parseInt(this.getAttribute('data-question'));
                    const optionIndex = parseInt(this.getAttribute('data-option'));
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø®ÙŠØ§Ø±Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„
                    const questionElement = document.getElementById(`question-${questionIndex}`);
                    questionElement.querySelectorAll('.option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±
                    this.classList.add('selected');
                    
                    // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
                    examState.answers[questionIndex] = optionIndex;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                    updateExamProgress();
                });
            });
        }

        // Ø¨Ø¯Ø¡ Ù…Ø¤Ù‚Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function startExamTimer() {
            if (examState.examTimer) {
                clearInterval(examState.examTimer);
            }
            
            examState.examTimer = setInterval(function() {
                examState.timeRemaining--;
                
                // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
                const minutes = Math.floor(examState.timeRemaining / 60);
                const seconds = examState.timeRemaining % 60;
                elements.remainingTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù‚ØªØ±Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ù…Ù† Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
                if (examState.timeRemaining < 300) { // Ø£Ù‚Ù„ Ù…Ù† 5 Ø¯Ù‚Ø§Ø¦Ù‚
                    elements.remainingTime.style.color = '#e74c3c';
                } else if (examState.timeRemaining < 600) { // Ø£Ù‚Ù„ Ù…Ù† 10 Ø¯Ù‚Ø§Ø¦Ù‚
                    elements.remainingTime.style.color = '#f39c12';
                }
                
                // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
                if (examState.timeRemaining <= 0) {
                    clearInterval(examState.examTimer);
                    alert('â° Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†!');
                    submitExam();
                }
            }, 1000);
        }

        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function updateExamProgress() {
            const answeredCount = examState.answers.filter(answer => answer !== null).length;
            const totalQuestions = examData.questions.length;
            const progressPercentage = (answeredCount / totalQuestions) * 100;
            
            elements.examProgress.style.width = `${progressPercentage}%`;
            elements.examProgressText.textContent = `${answeredCount}/${totalQuestions} Ø¥Ø¬Ø§Ø¨Ø©`;
            
            // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø¨Ø©
            if (progressPercentage < 30) {
                elements.examProgress.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
            } else if (progressPercentage < 70) {
                elements.examProgress.style.background = 'linear-gradient(90deg, #f39c12, #e67e22)';
            } else if (progressPercentage < 100) {
                elements.examProgress.style.background = 'linear-gradient(90deg, #3498db, #2980b9)';
            } else {
                elements.examProgress.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
            }
        }

        // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ÙˆØªØµØ­ÙŠØ­Ù‡
        function submitExam() {
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
            if (examState.examTimer) {
                clearInterval(examState.examTimer);
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„ÙŠÙ‡Ø§
            const unansweredQuestions = examState.answers.filter(answer => answer === null).length;
            
            if (unansweredQuestions > 0) {
                if (!confirm(`âš ï¸ Ù‡Ù†Ø§Ùƒ ${unansweredQuestions} Ø³Ø¤Ø§Ù„Ø§Ù‹ Ù„Ù… ØªØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„ÙŠÙ‡. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù…Ø¹ Ø°Ù„ÙƒØŸ`)) {
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¤Ù‚Øª
                    startExamTimer();
                    return;
                }
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            let score = 0;
            const mistakes = [];
            
            examData.questions.forEach((q, index) => {
                const studentAnswer = examState.answers[index];
                
                if (studentAnswer === q.correctAnswer) {
                    score++;
                } else if (studentAnswer !== null) {
                    mistakes.push({
                        questionNumber: index + 1,
                        question: q.question,
                        studentAnswer: q.options[studentAnswer],
                        correctAnswer: q.options[q.correctAnswer]
                    });
                } else {
                    mistakes.push({
                        questionNumber: index + 1,
                        question: q.question,
                        studentAnswer: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©",
                        correctAnswer: q.options[q.correctAnswer]
                    });
                }
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            showResults(score, mistakes);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            examState.examCompleted = true;
            
            // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ÙˆØ¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            elements.examSection.classList.add('hidden');
            elements.resultSection.classList.remove('hidden');
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„
            addToExamHistory(score, mistakes.length);
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function showResults(score, mistakes) {
            const percentage = (score / examData.questions.length) * 100;
            let grade = '';
            let gradeColor = '';
            let gradeEmoji = '';
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±
            if (percentage >= 90) {
                grade = 'Ø§Ù…ØªÙŠØ§Ø²';
                gradeColor = '#27ae60';
                gradeEmoji = 'ğŸ†';
            } else if (percentage >= 80) {
                grade = 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹';
                gradeColor = '#3498db';
                gradeEmoji = 'â­';
            } else if (percentage >= 70) {
                grade = 'Ø¬ÙŠØ¯';
                gradeColor = '#f39c12';
                gradeEmoji = 'ğŸ‘';
            } else if (percentage >= 60) {
                grade = 'Ù…Ù‚Ø¨ÙˆÙ„';
                gradeColor = '#e67e22';
                gradeEmoji = 'âœ…';
            } else {
                grade = 'Ø¶Ø¹ÙŠÙ';
                gradeColor = '#e74c3c';
                gradeEmoji = 'ğŸ“š';
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚
            const timeTaken = examState.startTime ? 
                Math.round((new Date() - examState.startTime) / 1000) : 0;
            const minutesTaken = Math.floor(timeTaken / 60);
            const secondsTaken = timeTaken % 60;
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Øµ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            let resultHTML = `
                <div class="result">
                    <h2 style="color: var(--secondary-color); margin-bottom: 15px;">${gradeEmoji} Ù†ØªÙŠØ¬Ø© Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 12px; color: #7f8c8d;">Ø§Ù„ØµÙ</div>
                            <div style="font-size: 18px; font-weight: bold; color: var(--secondary-color);">${examData.grade}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 12px; color: #7f8c8d;">Ø§Ù„ÙƒÙˆØ¯</div>
                            <div style="font-size: 18px; font-weight: bold; color: var(--primary-color);">${examState.studentCode}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.1);">
                            <div style="font-size: 12px; color: #7f8c8d;">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚</div>
                            <div style="font-size: 18px; font-weight: bold; color: var(--primary-color);">${minutesTaken} Ø¯ ${secondsTaken} Ø«</div>
                        </div>
                    </div>
                    
                    <div class="score">${score}/${examData.questions.length}</div>
                    
                    <div style="margin: 20px 0; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 12px; color: #7f8c8d;">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</div>
                                <div style="font-size: 24px; font-weight: bold; color: ${gradeColor};">${percentage.toFixed(1)}%</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #7f8c8d;">Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</div>
                                <div style="font-size: 24px; font-weight: bold; color: ${gradeColor};">${grade} ${gradeEmoji}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: ${percentage >= 60 ? '#d4efdf' : '#fdedec'}; border-radius: 10px; border: 2px solid ${percentage >= 60 ? '#27ae60' : '#e74c3c'};">
                        <p style="font-weight: bold; color: ${percentage >= 60 ? '#27ae60' : '#e74c3c'}; text-align: center;">
                            ${percentage >= 90 ? 'ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²' :
                              percentage >= 80 ? 'ğŸ‘ Ø£Ø­Ø³Ù†Øª! Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹' :
                              percentage >= 70 ? 'ğŸ‘ Ø¬ÙŠØ¯ØŒ Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªÙ…ÙŠØ²' :
                              percentage >= 60 ? 'âœ… Ù…Ù‚Ø¨ÙˆÙ„ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø³ÙŠÙ†' :
                              'ğŸ“š ØªØ­ØªØ§Ø¬ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ù…Ø°Ø§ÙƒØ±Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰'}
                        </p>
                    </div>
                </div>
            `;
            
            if (mistakes.length > 0) {
                let mistakesHTML = '<div class="mistakes"><h3>ğŸ“ Ø§Ù„ØªØµØ­ÙŠØ­ ÙˆØ§Ù„Ø£Ø®Ø·Ø§Ø¡:</h3>';
                
                mistakes.forEach((mistake) => {
                    const isCorrect = mistake.studentAnswer === mistake.correctAnswer;
                    
                    mistakesHTML += `
                        <div class="mistake-item">
                            <p><strong>Ø³ ${mistake.questionNumber}:</strong> ${mistake.question}</p>
                            <p>Ø¥Ø¬Ø§Ø¨ØªÙƒ: <span class="${isCorrect ? 'correct-answer' : 'wrong-answer'}">${mistake.studentAnswer}</span></p>
                            ${!isCorrect ? `<p>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: <span class="correct-answer">${mistake.correctAnswer}</span></p>` : ''}
                        </div>
                    `;
                });
                
                mistakesHTML += '</div>';
                resultHTML += mistakesHTML;
            } else {
                resultHTML += `
                    <div class="success-message" style="margin-top: 20px; padding: 20px;">
                        <h3>ğŸŠ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ğŸŠ</h3>
                        <p>Ù„Ù‚Ø¯ Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</p>
                    </div>
                `;
            }
            
            elements.resultContent.innerHTML = resultHTML;
        }

        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©
        function printResult() {
            const printWindow = window.open('', '_blank');
            const content = elements.resultContent.innerHTML;
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html dir="rtl">
                <head>
                    <title>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† - ${examState.studentCode}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .score { font-size: 36px; color: #27ae60; font-weight: bold; text-align: center; margin: 20px 0; }
                        .mistake-item { border-bottom: 1px solid #ddd; padding: 10px 0; }
                        .correct-answer { color: #27ae60; }
                        .wrong-answer { color: #e74c3c; }
                        @media print {
                            button { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <h1 style="text-align: center;">Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø§ØµØ©</h1>
                    <h2 style="text-align: center;">${examData.title}</h2>
                    <h3 style="text-align: center;">ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: ${examState.studentCode}</h3>
                    ${content}
                    <div style="text-align: center; margin-top: 30px; font-size: 12px; color: #7f8c8d;">
                        ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙŠ: ${new Date().toLocaleString('ar-EG')}
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => printWindow.print(), 500);
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function resetExam() {
            examState = {
                studentCode: '',
                answers: new Array(examData.questions.length).fill(null),
                startTime: null,
                examCompleted: false,
                deviceId: examState.deviceId,
                examTimer: null,
                timeRemaining: examData.duration
            };
            
            elements.studentCodeInput.value = '';
            elements.codeProgress.style.width = '0%';
            elements.codeError.textContent = '';
            elements.startExamBtn.disabled = true;
            elements.studentCodeInput.disabled = false;
            elements.studentCodeInput.focus();
            elements.btnText.textContent = 'Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateStatistics();
        }

        // ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… =====
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ø¬Ù‡Ø§Ø² ÙØ±ÙŠØ¯ Ù…Ø¹Ù‚Ø¯ Ù„Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ
        function generateAdvancedDeviceId() {
            // Ø¬Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ø¹Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²
            const components = [
                navigator.userAgent,
                navigator.platform,
                navigator.language,
                navigator.hardwareConcurrency || 'unknown',
                `${screen.width}x${screen.height}x${screen.colorDepth}`,
                new Date().getTimezoneOffset(),
                Math.random().toString(36).substring(2, 20),
                Math.random().toString(36).substring(2, 20),
                performance.now().toString(),
                'GRADE7_SECURE_ID' // Ù…Ø¹Ø±Ù‘Ù Ø®Ø§Øµ Ù„Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ
            ];
            
            // Ø¯Ù…Ø¬Ù‡Ø§ ÙˆØ¥Ù†Ø´Ø§Ø¡ hash ÙØ±ÙŠØ¯
            const combined = components.join('|||');
            let hash = 0;
            
            for (let i = 0; i < combined.length; i++) {
                const char = combined.charCodeAt(i);
                hash = ((hash << 7) - hash) + char;
                hash = hash & 0x7FFFFFFF;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù…Ø¹ Ø¨Ø§Ø¯Ø¦Ø© Ø®Ø§ØµØ©
            const timestamp = Date.now().toString(36).toUpperCase();
            const randomPart = Math.random().toString(36).substring(2, 15).toUpperCase();
            const checksum = (hash % 9999).toString().padStart(4, '0');
            
            return `G7-${hash.toString(36).toUpperCase().substring(0, 8)}-${timestamp.substring(0, 6)}-${randomPart.substring(0, 6)}-${checksum}`;
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ ØªØ®Ø²ÙŠÙ† ÙØ±ÙŠØ¯ Ù„ÙƒÙ„ ÙƒÙˆØ¯
        function generateCodeStorageKey(code) {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø£ÙƒØ«Ø± ØªØ¹Ù‚ÙŠØ¯Ø§Ù‹
            const salt = "G7_EXAM_SYSTEM_2024_SECURE_SALT_V2";
            const data = code + salt + examState.deviceId + "GRADE7";
            
            let hash = 0;
            for (let i = 0; i < data.length; i++) {
                const char = data.charCodeAt(i);
                hash = ((hash << 9) - hash) + char;
                hash = hash & 0x7FFFFFFF;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ø¨Ø¹ Ø²Ù…Ù†ÙŠ ÙˆØ¬Ø²Ø¡ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
            const timestamp = Date.now();
            const randomSuffix = Math.random().toString(36).substring(2, 12).toUpperCase();
            
            return `G7_EXAM_RECORD_${hash}_${timestamp}_${randomSuffix}`;
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
        function getExamAttempts() {
            const deviceKey = `G7_DEVICE_RECORDS_${examState.deviceId}`;
            const storedData = localStorage.getItem(deviceKey);
            
            if (!storedData) {
                return {
                    deviceId: examState.deviceId,
                    deviceAttempts: 0,
                    usedCodes: [],
                    lastAttempt: null,
                    creationDate: new Date().toISOString(),
                    version: '1.0'
                };
            }
            
            try {
                const parsedData = JSON.parse(storedData);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (parsedData.deviceId !== examState.deviceId || parsedData.version !== '1.0') {
                    return {
                        deviceId: examState.deviceId,
                        deviceAttempts: 0,
                        usedCodes: [],
                        lastAttempt: null,
                        creationDate: new Date().toISOString(),
                        version: '1.0'
                    };
                }
                
                return parsedData;
            } catch (e) {
                return {
                    deviceId: examState.deviceId,
                    deviceAttempts: 0,
                    usedCodes: [],
                    lastAttempt: null,
                    creationDate: new Date().toISOString(),
                    version: '1.0'
                };
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù…Ù‹Ø§ Ù…Ù† Ù‚Ø¨Ù„
        function isCodeAlreadyUsed(code) {
            const attempts = getExamAttempts();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø²
            if (attempts.usedCodes.includes(code)) {
                return true;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ© Ù„Ù„ÙƒÙˆØ¯
            const codeHash = btoa(encodeURIComponent(code + examState.deviceId + "G7_CHECK")).replace(/=/g, '');
            const codeRecords = localStorage.getItem(`G7_CODE_${codeHash}_RECORDS`);
            
            if (codeRecords) {
                try {
                    const records = JSON.parse(codeRecords);
                    return records.some(record => record.deviceId === examState.deviceId);
                } catch (e) {
                    return false;
                }
            }
            
            return false;
        }

        // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function registerNewAttempt(code) {
            const attempts = getExamAttempts();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
            if (attempts.deviceAttempts >= 2) {
                return {
                    success: false,
                    message: "âŒ Ù„Ù‚Ø¯ Ø§Ø³ØªØ®Ø¯Ù…Øª Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù…Ø±ØªÙŠÙ† Ø¨Ø§Ù„ÙØ¹Ù„."
                };
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù…Ù‹Ø§
            if (isCodeAlreadyUsed(code)) {
                return {
                    success: false,
                    message: "âŒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²"
                };
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
            attempts.deviceAttempts += 1;
            attempts.lastAttempt = new Date().toISOString();
            
            if (!attempts.usedCodes.includes(code)) {
                attempts.usedCodes.push(code);
            }
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
            localStorage.setItem(`G7_DEVICE_RECORDS_${examState.deviceId}`, JSON.stringify(attempts));
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ù…ÙØµÙ„ Ù„Ù„ÙƒÙˆØ¯
            const codeRecord = {
                code: code,
                deviceId: examState.deviceId,
                examDate: new Date().toISOString(),
                examTitle: examData.title,
                examGrade: examData.grade,
                examType: examData.type,
                // Ø±Ù…ÙˆØ² Ø£Ù…Ù†ÙŠØ©
                recordId: `G7-REC-${Date.now()}-${Math.random().toString(36).substring(2, 15).toUpperCase()}`,
                securityToken: `G7-TOKEN-${Math.random().toString(36).substring(2, 20)}-${Date.now()}`,
                verificationCode: `G7-VER-${Math.random().toString(36).substring(2, 10).toUpperCase()}`
            };
            
            // Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„ÙƒÙˆØ¯
            const storageKey = generateCodeStorageKey(code);
            localStorage.setItem(storageKey, JSON.stringify(codeRecord));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„ÙƒÙˆØ¯
            updateCodeGlobalRecords(code, codeRecord);
            
            return {
                success: true,
                message: "âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­"
            };
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ÙƒÙˆØ¯
        function updateCodeGlobalRecords(code, record) {
            const codeHash = btoa(encodeURIComponent(code + examState.deviceId + "G7_GLOBAL")).replace(/=/g, '');
            const globalKey = `G7_CODE_${codeHash}_RECORDS`;
            let existingRecords = [];
            
            try {
                const stored = localStorage.getItem(globalKey);
                if (stored) {
                    existingRecords = JSON.parse(stored);
                }
            } catch (e) {
                existingRecords = [];
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            existingRecords.push({
                deviceId: record.deviceId,
                date: record.examDate,
                recordId: record.recordId,
                grade: record.examGrade,
                securityToken: record.securityToken.substring(0, 10) + "..."
            });
            
            // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
            localStorage.setItem(globalKey, JSON.stringify(existingRecords));
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
        function addToExamHistory(score, mistakesCount) {
            const examHistory = {
                code: examState.studentCode,
                deviceId: examState.deviceId,
                score: score,
                totalQuestions: examData.questions.length,
                percentage: ((score / examData.questions.length) * 100).toFixed(1),
                mistakes: mistakesCount,
                date: new Date().toISOString(),
                examTitle: examData.title,
                examGrade: examData.grade,
                examType: examData.type,
                timeTaken: examState.startTime ? Math.round((new Date() - examState.startTime) / 1000) : 0,
                // Ù…ÙØªØ§Ø­ ØªØ®Ø²ÙŠÙ† ÙØ±ÙŠØ¯
                storageKey: `G7_RESULT_${Date.now()}_${Math.random().toString(36).substring(2, 15)}`,
                securityStamp: `G7-STAMP-${Math.random().toString(36).substring(2, 12).toUpperCase()}`
            };
            
            // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            localStorage.setItem(examHistory.storageKey, JSON.stringify(examHistory));
        }
    </script>
</body>
</html>